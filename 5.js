(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{Ds32:function(t,e,i){!function(t,i){i(e)}(0,(function(t){"use strict";function e(t,i){if(s(t)||s(i))for(const o in i)if(Object.prototype.hasOwnProperty.call(i,o)){const r=t[o],l=i[o];s(l)&&s(r)&&!n(l)&&!n(r)?e(r,l):a(i[o])&&(t[o]=i[o])}}function i(t){if(!s(t)||!n(t))return t;let e;e=n(t)?[]:{};for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const o=t[n];s(o)?e[n]=i(o):e[n]=o}return e}function n(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t){return"function"==typeof t}function s(t){return"object"==typeof t}function r(t){return"number"==typeof t&&!isNaN(t)}function a(t){return null!=t}function l(t){return"string"==typeof t}const c=/\\(\\)?/g,h=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");function d(t,e,i){if(a(t)){const n=[];e.replace(h,((t,...e)=>{let i=t;return a(e[1])?i=e[2].replace(c,"$1"):a(e[0])&&(i=e[0].trim()),n.push(i),""}));let o=t,s=0;const r=n.length;for(;a(o)&&s<r;)o=null==o?void 0:o[n[s++]];return a(o)?o:null!=i?i:"--"}return null!=i?i:"--"}function u(t,e,i){const n=t.format(new Date(e)).split(", "),o=n[0].split("/"),s=n[1].split(":"),r={YYYY:o[2],MM:o[0],DD:o[1],HH:"24"===s[0]?"00":s[0],mm:s[1],ss:s[2]};return i.replace(/YYYY|MM|DD|HH|mm|ss/g,(t=>r[t]))}function g(t,e){const i=+t;return r(i)?i.toFixed(null!=e?e:2):`${i}`}function v(t){const e=+t;return r(e)?t>1e9?+(e/1e9).toFixed(3)+"B":t>1e6?+(e/1e6).toFixed(3)+"M":t>1e3?+(e/1e3).toFixed(3)+"K":`${t}`:"--"}var m,p,_,x,f,y,S,C,b,w;!function(t){t.Dashed="dashed",t.Solid="solid"}(m||(m={})),function(t){t.Stroke="stroke",t.Fill="fill",t.StrokeFill="stroke_fill"}(p||(p={})),function(t){t.Always="always",t.FollowCross="follow_cross",t.None="none"}(_||(_={})),function(t){t.Standard="standard",t.Rect="rect"}(x||(x={})),function(t){t.Left="left",t.Middle="middle",t.Right="right"}(f||(f={})),function(t){t.CandleSolid="candle_solid",t.CandleStroke="candle_stroke",t.CandleUpStroke="candle_up_stroke",t.CandleDownStroke="candle_down_stroke",t.Ohlc="ohlc",t.Area="area"}(y||(y={})),function(t){t.Left="left",t.Right="right"}(S||(S={})),function(t){t.Normal="normal",t.Percentage="percentage",t.Log="log"}(C||(C={})),function(t){t[t.Tooltip=0]="Tooltip",t[t.Crosshair=1]="Crosshair",t[t.XAxis=2]="XAxis"}(b||(b={})),function(t){t.OnZoom="onZoom",t.OnScroll="onScroll",t.OnVisibleRangeChange="onVisibleRangeChange",t.OnTooltipIconClick="onTooltipIconClick",t.OnCrosshairChange="onCrosshairChange",t.OnPaneDrag="onPaneDrag"}(w||(w={}));class I{constructor(){this._callbacks=[]}subscribe(t){var e;(null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1)<0&&this._callbacks.push(t)}unsubscribe(t){var e;if(void 0!==t){const i=null!==(e=this._callbacks.indexOf(t))&&void 0!==e?e:-1;i>-1&&this._callbacks.splice(i,1)}else this._callbacks=[]}execute(t){this._callbacks.forEach((e=>{e(t)}))}isEmpty(){return 0===this._callbacks.length}}const E=new class{constructor(){this._baseId=1}next(t){const e=(new Date).getTime();return e===this._prevIdTimestamp?++this._baseId:this._baseId=1,this._prevIdTimestamp=e,`${null!=t?t:""}${e}_${this._baseId}`}};function T(t){return E.next(t)}function D(t,e){var i;const n=document.createElement(t),o=null!=e?e:{};for(const s in o)n.style[s]=null!==(i=o[s])&&void 0!==i?i:"";return n}let M;function P(t){var e,i,n;return null!==(n=null===(i=null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||void 0===i?void 0:i.devicePixelRatio)&&void 0!==n?n:2}function k(t,e,i){return`${null!=e?e:"normal"} ${null!=t?t:12}px ${null!=i?i:"Helvetica Neue"}`}function A(t,e,i,n){if(void 0===M){const t=document.createElement("canvas"),e=P(t);M=t.getContext("2d"),M.scale(e,e)}return M.font=k(e,i,n),Math.round(M.measureText(t).width)}function F(t,e,i){let n=0,o=0;for(o=t.length-1;n!==o;){const s=Math.floor((o+n)/2),r=o-n,a=t[s][e];if(i===t[n][e])return n;if(i===t[o][e])return o;if(i===a)return s;if(i>a?n=s:o=s,r<=2)break}return n}function L(t,e){return null==e&&(e=10),e=Math.min(Math.max(0,e),20),+(+t).toFixed(e)}function R(t,e,i){const n=[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER];return t.forEach((t=>{var o,s;n[0]=Math.max(null!==(o=t[e])&&void 0!==o?o:t,n[0]),n[1]=Math.min(null!==(s=t[i])&&void 0!==s?s:t,n[1])})),n}function B(t){return Math.log(t)/Math.log(10)}function N(t){return Math.pow(10,t)}const V=1,O=50;class W{constructor(t){this._dateTimeFormat=this._buildDateTimeFormat(),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalBarSpace=0,this._barSpace=6,this._offsetRightDistance=50,this._startScrollOffsetRightBarCount=0,this._minVisibleBarCount={left:2,right:2},this._visibleRange={from:0,to:0},this._chartStore=t,this._gapBarSpace=this._calcGapBarSpace(),this._offsetRightBarCount=this._offsetRightDistance/this._barSpace}_calcGapBarSpace(){const t=Math.floor(.82*this._barSpace),e=Math.floor(this._barSpace),i=Math.min(t,e-1);return Math.max(1,i)}adjustVisibleRange(){var t;const e=this._chartStore.getDataList(),i=e.length,n=this._totalBarSpace/this._barSpace,o=n-Math.min(this._minVisibleBarCount.left,i);this._offsetRightBarCount>o&&(this._offsetRightBarCount=o);const s=-i+Math.min(this._minVisibleBarCount.right,i);this._offsetRightBarCount<s&&(this._offsetRightBarCount=s);let r=Math.round(this._offsetRightBarCount+i+.5);r>i&&(r=i);let a=Math.round(r-n)-1;if(a<0&&(a=0),this._visibleRange={from:a,to:r},this._chartStore.getActionStore().execute(w.OnVisibleRangeChange,{from:a,to:r}),this._chartStore.adjustVisibleDataList(),0===a&&this._more&&!this._loading&&null!==this._loadMoreCallback){this._loading=!0;const i=e[0];this._loadMoreCallback(null!==(t=null==i?void 0:i.timestamp)&&void 0!==t?t:null)}}setMore(t){return this._more=t,this}setLoading(t){return this._loading=t,this}getDateTimeFormat(){return this._dateTimeFormat}_buildDateTimeFormat(t){const e={hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};void 0!==t&&(e.timeZone=t);let i=null;try{i=new Intl.DateTimeFormat("en",e)}catch(t){}return i}setTimezone(t){const e=this._buildDateTimeFormat(t);null!==e&&(this._dateTimeFormat=e)}getTimezone(){return this._dateTimeFormat.resolvedOptions().timeZone}getBarSpace(){return{bar:this._barSpace,halfBar:this._barSpace/2,gapBar:this._gapBarSpace,halfGapBar:this._gapBarSpace/2}}setBarSpace(t,e){t<V||t>O||this._barSpace===t||(this._barSpace=t,this._gapBarSpace=this._calcGapBarSpace(),null==e||e(),this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0))}setTotalBarSpace(t){return this._totalBarSpace!==t&&(this._totalBarSpace=t,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0)),this}setOffsetRightDistance(t,e){return this._offsetRightDistance=t,this._offsetRightBarCount=t/this._barSpace,null!=e&&e&&(this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)),this}resetOffsetRightDistance(){this.setOffsetRightDistance(this._offsetRightDistance)}getOffsetRightDistance(){return this._offsetRightDistance}getOffsetRightBarCount(){return this._offsetRightBarCount}setOffsetRightBarCount(t){return this._offsetRightBarCount=t,this}setLeftMinVisibleBarCount(t){return this._minVisibleBarCount.left=t,this}setRightMinVisibleBarCount(t){return this._minVisibleBarCount.right=t,this}getVisibleRange(){return this._visibleRange}startScroll(){this._startScrollOffsetRightBarCount=this._offsetRightBarCount}scroll(t){if(!this._scrollEnabled)return;const e=t/this._barSpace;this._chartStore.getActionStore().execute(w.OnScroll),this._offsetRightBarCount=this._startScrollOffsetRightBarCount-e,this.adjustVisibleRange(),this._chartStore.getCrosshairStore().recalculate(!0),this._chartStore.getChart().adjustPaneViewport(!1,!0,!0,!0)}getDataByDataIndex(t){var e;return null!==(e=this._chartStore.getDataList()[t])&&void 0!==e?e:null}coordinateToFloatIndex(t){const e=this._chartStore.getDataList().length,i=(this._totalBarSpace-t)/this._barSpace,n=e+this._offsetRightBarCount-i;return Math.round(1e6*n)/1e6}dataIndexToTimestamp(t){var e;const i=this.getDataByDataIndex(t);return null!==(e=null==i?void 0:i.timestamp)&&void 0!==e?e:null}timestampToDataIndex(t){const e=this._chartStore.getDataList();return 0===e.length?0:F(e,"timestamp",t)}dataIndexToCoordinate(t){const e=this._chartStore.getDataList().length+this._offsetRightBarCount-t;return this._totalBarSpace-(e-.5)*this._barSpace}coordinateToDataIndex(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}zoom(t,e){if(!this._zoomEnabled)return;if(void 0===(null==e?void 0:e.x)){const t=this._chartStore.getCrosshairStore().get();e={x:void 0!==(null==t?void 0:t.x)?t.x:this._totalBarSpace/2}}this._chartStore.getActionStore().execute(w.OnZoom);const i=this.coordinateToFloatIndex(e.x),n=this._barSpace+t*(this._barSpace/10);this.setBarSpace(n,(()=>{this._offsetRightBarCount+=i-this.coordinateToFloatIndex(null==e?void 0:e.x)}))}setZoomEnabled(t){return this._zoomEnabled=t,this}getZoomEnabled(){return this._zoomEnabled}setScrollEnabled(t){return this._scrollEnabled=t,this}getScrollEnabled(){return this._scrollEnabled}setLoadMoreCallback(t){return this._loadMoreCallback=t,this}clear(){this._more=!0,this._loading=!0,this._visibleRange={from:0,to:0}}}var z;function Y(t,e,i,n,o){const s=e.result,r=e.figures,l=e.styles,c=d(l,"circles",n.circles),h=c.length,u=d(l,"bars",n.bars),g=u.length,v=d(l,"lines",n.lines),m=v.length;let p,_,x,f=0,y=0,S=0,C=0;r.forEach((r=>{var l,d,b,w;switch(r.type){case"circle":p=c[f%h],_=p.style,x=p.noChangeColor,C=f,f++;break;case"bar":p=u[y%g],_=p.style,x=p.noChangeColor,C=y,y++;break;case"line":p=v[S%m],_=p.style,x=p.color,C=S,S++}if(a(p)){const a={prev:{kLineData:t[i-1],indicatorData:s[i-1]},current:{kLineData:t[i],indicatorData:s[i]},next:{kLineData:t[i+1],indicatorData:s[i+1]}},c=null!==(d=null===(l=r.styles)||void 0===l?void 0:l.call(r,a,e,n))&&void 0!==d?d:{style:_,color:x};o(r,{style:null!==(b=c.style)&&void 0!==b?b:_,color:null!==(w=c.color)&&void 0!==w?w:x},p,C)}}))}!function(t){t.Normal="normal",t.Price="price",t.Volume="volume"}(z||(z={}));class X{constructor(t){this.result=[],this._precisionFlag=!1;const{name:e,shortName:i,series:n,calcParams:o,figures:s,precision:r,shouldOhlc:a,shouldFormatBigNumber:l,visible:c,minValue:h,maxValue:d,styles:u,extendData:g,regenerateFigures:v,createTooltipDataSource:m,draw:p}=t;this.name=e,this.shortName=null!=i?i:e,this.series=null!=n?n:z.Normal,this.precision=null!=r?r:4,this.calcParams=null!=o?o:[],this.figures=null!=s?s:[],this.shouldOhlc=null!=a&&a,this.shouldFormatBigNumber=null!=l&&l,this.visible=null==c||c,this.minValue=null!=h?h:null,this.maxValue=null!=d?d:null,this.styles=null!=u?u:null,this.extendData=g,this.regenerateFigures=null!=v?v:null,this.createTooltipDataSource=null!=m?m:null,this.draw=null!=p?p:null}setShortName(t){return this.shortName!==t&&(this.shortName=t,!0)}setSeries(t){return this.series!==t&&(this.series=t,!0)}setPrecision(t,e){const i=null!=e&&e,n=Math.floor(t);return!(!(n!==this.precision&&t>=0)||i&&(!i||this._precisionFlag))&&(this.precision=n,i||(this._precisionFlag=!0),!0)}setCalcParams(t){var e,i;return this.calcParams=t,this.figures=null!==(i=null===(e=this.regenerateFigures)||void 0===e?void 0:e.call(this,t))&&void 0!==i?i:this.figures,!0}setShouldOhlc(t){return this.shouldOhlc!==t&&(this.shouldOhlc=t,!0)}setShouldFormatBigNumber(t){return this.shouldFormatBigNumber!==t&&(this.shouldFormatBigNumber=t,!0)}setVisible(t){return this.visible!==t&&(this.visible=t,!0)}setStyles(t){return this.styles!==t&&(this.styles=t,!0)}setExtendData(t){return this.extendData!==t&&(this.extendData=t,!0)}setFigures(t){return this.figures!==t&&(this.figures=t,!0)}setMinValue(t){return this.minValue!==t&&(this.minValue=t,!0)}setMaxValue(t){return this.maxValue!==t&&(this.maxValue=t,!0)}setRegenerateFigures(t){return this.regenerateFigures!==t&&(this.regenerateFigures=t,!0)}setCreateTooltipDataSource(t){return this.createTooltipDataSource!==t&&(this.createTooltipDataSource=t,!0)}setDraw(t){return this.draw!==t&&(this.draw=t,!0)}async calcIndicator(t){try{const e=await this.calc(t,this);return this.result=e,!0}catch(t){return!1}}static extend(t){return class extends X{constructor(){super(t)}calc(e,i){return t.calc(e,i)}}}}const H={name:"AVP",shortName:"AVP",series:z.Price,precision:2,figures:[{key:"avp",title:"AVP: ",type:"line"}],calc:t=>{let e=0,i=0;return t.map((t=>{var n,o;const s={},r=null!==(n=null==t?void 0:t.turnover)&&void 0!==n?n:0,a=null!==(o=null==t?void 0:t.volume)&&void 0!==o?o:0;return e+=r,i+=a,0!==i&&(s.avp=e/i),s}))}},$={name:"AO",shortName:"AO",calcParams:[5,34],figures:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,styles:(t,e,i)=>{var n,o,s,r;const{prev:a,current:l}=t,c=null!==(o=null===(n=a.indicatorData)||void 0===n?void 0:n.ao)&&void 0!==o?o:Number.MIN_SAFE_INTEGER,h=null!==(r=null===(s=l.indicatorData)||void 0===s?void 0:s.ao)&&void 0!==r?r:Number.MIN_SAFE_INTEGER;let u;return u=h>c?d(e.styles,"bars[0].upColor",i.bars[0].upColor):d(e.styles,"bars[0].downColor",i.bars[0].downColor),{color:u,style:h>c?"stroke":"fill"}}}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(i[0],i[1]);let o=0,s=0,r=0,a=0;return t.map(((e,l)=>{const c={},h=(e.low+e.high)/2;if(o+=h,s+=h,l>=i[0]-1){r=o/i[0];const e=t[l-(i[0]-1)];o-=(e.low+e.high)/2}if(l>=i[1]-1){a=s/i[1];const e=t[l-(i[1]-1)];s-=(e.low+e.high)/2}return l>=n-1&&(c.ao=r-a),c}))}},j={name:"BOLL",shortName:"BOLL",series:z.Price,calcParams:[20,2],precision:2,shouldOhlc:!0,figures:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=i[0]-1;let o=0;return t.map(((e,s)=>{const r=e.close,a={};if(o+=r,s>=n){a.mid=o/i[0];const e=function(t,e){const i=t.length;let n=0;return t.forEach((t=>{const i=t.close-e;n+=i*i})),n=Math.abs(n),Math.sqrt(n/i)}(t.slice(s-n,s+1),a.mid);a.up=a.mid+i[1]*e,a.dn=a.mid-i[1]*e,o-=t[s-n].close}return a}))}},G={name:"BBI",shortName:"BBI",series:z.Price,precision:2,calcParams:[3,6,12,24],shouldOhlc:!0,figures:[{key:"bbi",title:"BBI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(...i),o=[],s=[];return t.map(((e,r)=>{const a={},l=e.close;if(i.forEach(((e,i)=>{var n;o[i]=(null!==(n=o[i])&&void 0!==n?n:0)+l,r>=e-1&&(s[i]=o[i]/e,o[i]-=t[r-(e-1)].close)})),r>=n-1){let t=0;s.forEach((e=>{t+=e})),a.bbi=t/4}return a}))}},U={name:"CCI",shortName:"CCI",calcParams:[20],figures:[{key:"cci",title:"CCI: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=i[0]-1;let o=0;const s=[];return t.map(((e,r)=>{const a={},l=(e.high+e.low+e.close)/3;if(o+=l,s.push(l),r>=n){const e=o/i[0],c=s.slice(r-n,r+1);let h=0;c.forEach((t=>{h+=Math.abs(t-e)}));const d=h/i[0];a.cci=0!==d?(l-e)/d/.015:0;const u=(t[r-n].high+t[r-n].low+t[r-n].close)/3;o-=u}return a}))}},Z={name:"CR",shortName:"CR",calcParams:[26,10,20,40,60],figures:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.ceil(i[1]/2.5+1),o=Math.ceil(i[2]/2.5+1),s=Math.ceil(i[3]/2.5+1),r=Math.ceil(i[4]/2.5+1);let a=0;const l=[];let c=0;const h=[];let d=0;const u=[];let g=0;const v=[],m=[];return t.forEach(((e,p)=>{var _,x,f,y,S;const C={},b=null!==(_=t[p-1])&&void 0!==_?_:e,w=(b.high+b.close+b.low+b.open)/4,I=Math.max(0,e.high-w),E=Math.max(0,w-e.low);p>=i[0]-1&&(C.cr=0!==E?I/E*100:0,a+=C.cr,c+=C.cr,d+=C.cr,g+=C.cr,p>=i[0]+i[1]-2&&(l.push(a/i[1]),p>=i[0]+i[1]+n-3&&(C.ma1=l[l.length-1-n]),a-=null!==(x=m[p-(i[1]-1)].cr)&&void 0!==x?x:0),p>=i[0]+i[2]-2&&(h.push(c/i[2]),p>=i[0]+i[2]+o-3&&(C.ma2=h[h.length-1-o]),c-=null!==(f=m[p-(i[2]-1)].cr)&&void 0!==f?f:0),p>=i[0]+i[3]-2&&(u.push(d/i[3]),p>=i[0]+i[3]+s-3&&(C.ma3=u[u.length-1-s]),d-=null!==(y=m[p-(i[3]-1)].cr)&&void 0!==y?y:0),p>=i[0]+i[4]-2&&(v.push(g/i[4]),p>=i[0]+i[4]+r-3&&(C.ma4=v[v.length-1-r]),g-=null!==(S=m[p-(i[4]-1)].cr)&&void 0!==S?S:0)),m.push(C)})),m}},q={name:"DMA",shortName:"DMA",calcParams:[10,50,10],figures:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=Math.max(i[0],i[1]);let o=0,s=0,r=0;const a=[];return t.forEach(((e,l)=>{var c;const h={},d=e.close;o+=d,s+=d;let u=0,g=0;if(l>=i[0]-1&&(u=o/i[0],o-=t[l-(i[0]-1)].close),l>=i[1]-1&&(g=s/i[1],s-=t[l-(i[1]-1)].close),l>=n-1){const t=u-g;h.dma=t,r+=t,l>=n+i[2]-2&&(h.ama=r/i[2],r-=null!==(c=a[l-(i[2]-1)].dma)&&void 0!==c?c:0)}a.push(h)})),a}},K={name:"DMI",shortName:"DMI",calcParams:[14,6],figures:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,o=0,s=0,r=0,a=0,l=0,c=0,h=0;const d=[];return t.forEach(((e,u)=>{var g,v;const m={},p=null!==(g=t[u-1])&&void 0!==g?g:e,_=p.close,x=e.high,f=e.low,y=x-f,S=Math.abs(x-_),C=Math.abs(_-f),b=x-p.high,w=p.low-f,I=Math.max(Math.max(y,S),C),E=b>0&&b>w?b:0,T=w>0&&w>b?w:0;if(n+=I,o+=E,s+=T,u>=i[0]-1){u>i[0]-1?(r=r-r/i[0]+I,a=a-a/i[0]+E,l=l-l/i[0]+T):(r=n,a=o,l=s);let t=0,e=0;0!==r&&(t=100*a/r,e=100*l/r),m.pdi=t,m.mdi=e;let g=0;e+t!==0&&(g=Math.abs(e-t)/(e+t)*100),c+=g,u>=2*i[0]-2&&(h=u>2*i[0]-2?(h*(i[0]-1)+g)/i[0]:c/i[0],m.adx=h,u>=2*i[0]+i[1]-3&&(m.adxr=((null!==(v=d[u-(i[1]-1)].adx)&&void 0!==v?v:0)+h)/2))}d.push(m)})),d}},J={name:"EMA",shortName:"EMA",series:z.Price,calcParams:[6,12,20],precision:2,shouldOhlc:!0,figures:[{key:"ema1",title:"EMA6: ",type:"line"},{key:"ema2",title:"EMA12: ",type:"line"},{key:"ema3",title:"EMA20: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`ema${e+1}`,title:`EMA${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e;let o=0;const s=[];return t.map(((t,e)=>{const r={},a=t.close;return o+=a,i.forEach(((t,i)=>{e>=t-1&&(s[i]=e>t-1?(2*a+(t-1)*s[i])/(t+1):o/t,r[n[i].key]=s[i])})),r}))}},Q={name:"MA",shortName:"MA",series:z.Price,calcParams:[5,10,30,60],precision:2,shouldOhlc:!0,figures:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e,o=[];return t.map(((e,s)=>{const r={},a=e.close;return i.forEach(((e,i)=>{var l;o[i]=(null!==(l=o[i])&&void 0!==l?l:0)+a,s>=e-1&&(r[n[i].key]=o[i]/e,o[i]-=t[s-(e-1)].close)})),r}))}},tt={name:"MACD",shortName:"MACD",calcParams:[12,26,9],figures:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,styles:(t,e,i)=>{var n,o,s,r;const{prev:a,current:l}=t,c=null!==(o=null===(n=a.indicatorData)||void 0===n?void 0:n.macd)&&void 0!==o?o:Number.MIN_SAFE_INTEGER,h=null!==(r=null===(s=l.indicatorData)||void 0===s?void 0:s.macd)&&void 0!==r?r:Number.MIN_SAFE_INTEGER;let u;return u=h>0?d(e.styles,"bars[0].upColor",i.bars[0].upColor):h<0?d(e.styles,"bars[0].downColor",i.bars[0].downColor):d(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{style:c<h?"stroke":"fill",color:u}}}],calc:(t,e)=>{const i=e.calcParams;let n,o,s=0,r=0,a=0,l=0;const c=Math.max(i[0],i[1]);return t.map(((t,e)=>{const h={},d=t.close;return s+=d,e>=i[0]-1&&(n=e>i[0]-1?(2*d+(i[0]-1)*n)/(i[0]+1):s/i[0]),e>=i[1]-1&&(o=e>i[1]-1?(2*d+(i[1]-1)*o)/(i[1]+1):s/i[1]),e>=c-1&&(r=n-o,h.dif=r,a+=r,e>=c+i[2]-2&&(l=e>c+i[2]-2?(2*r+l*(i[2]-1))/(i[2]+1):a/i[2],h.macd=2*(r-l),h.dea=l)),h}))}},et={name:"RSI",shortName:"RSI",calcParams:[6,12,24],figures:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>{const i=e+1;return{key:`rsi${i}`,title:`RSI${i}: `,type:"line"}})),calc:(t,e)=>{const{calcParams:i,figures:n}=e,o=[],s=[];return t.map(((e,r)=>{var a;const l={},c=(null!==(a=t[r-1])&&void 0!==a?a:e).close,h=e.close-c;return i.forEach(((e,i)=>{var a,c,d;if(h>0?o[i]=(null!==(a=o[i])&&void 0!==a?a:0)+h:s[i]=(null!==(c=s[i])&&void 0!==c?c:0)+Math.abs(h),r>=e-1){0!==s[i]?l[n[i].key]=100-100/(1+o[i]/s[i]):l[n[i].key]=0;const a=t[r-(e-1)],c=null!==(d=t[r-e])&&void 0!==d?d:a,h=a.close-c.close;h>0?o[i]-=h:s[i]-=Math.abs(h)}})),l}))}},it={name:"SMA",shortName:"SMA",series:z.Price,calcParams:[12,2],precision:2,figures:[{key:"sma",title:"SMA: ",type:"line"}],shouldOhlc:!0,calc:(t,e)=>{const i=e.calcParams;let n=0,o=0;return t.map(((t,e)=>{const s={},r=t.close;return n+=r,e>=i[0]-1&&(o=e>i[0]-1?(r*i[1]+o*(i[0]-i[1]+1))/(i[0]+1):n/i[0],s.sma=o),s}))}},nt={name:"KDJ",shortName:"KDJ",calcParams:[9,3,3],figures:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=[];return t.forEach(((e,o)=>{var s,r,a,l;const c={},h=e.close;if(o>=i[0]-1){const e=R(t.slice(o-(i[0]-1),o+1),"high","low"),d=e[0],u=e[1],g=d-u,v=(h-u)/(0===g?1:g)*100;c.k=((i[1]-1)*(null!==(r=null===(s=n[o-1])||void 0===s?void 0:s.k)&&void 0!==r?r:50)+v)/i[1],c.d=((i[2]-1)*(null!==(l=null===(a=n[o-1])||void 0===a?void 0:a.d)&&void 0!==l?l:50)+c.k)/i[2],c.j=3*c.k-2*c.d}n.push(c)})),n}},ot={name:"SAR",shortName:"SAR",series:z.Price,calcParams:[2,2,20],precision:2,shouldOhlc:!0,figures:[{key:"sar",title:"SAR: ",type:"circle",styles:(t,e,i)=>{var n,o;const{current:s}=t,r=null!==(o=null===(n=s.indicatorData)||void 0===n?void 0:n.sar)&&void 0!==o?o:Number.MIN_SAFE_INTEGER,a=s.kLineData;return{color:r<((null==a?void 0:a.high)+(null==a?void 0:a.low))/2?d(e.styles,"circles[0].upColor",i.circles[0].upColor):d(e.styles,"circles[0].downColor",i.circles[0].downColor)}}}],calc:(t,e)=>{const i=e.calcParams,n=i[0]/100,o=i[1]/100,s=i[2]/100;let r=n,a=-100,l=!1,c=0;return t.map(((e,i)=>{const h=c,d=e.high,u=e.low;if(l){(-100===a||a<d)&&(a=d,r=Math.min(r+o,s)),c=h+r*(a-h);const g=Math.min(t[Math.max(1,i)-1].low,u);c>e.low?(c=a,r=n,a=-100,l=!l):c>g&&(c=g)}else{(-100===a||a>u)&&(a=u,r=Math.min(r+o,s)),c=h+r*(a-h);const n=Math.max(t[Math.max(1,i)-1].high,d);c<e.high?(c=a,r=0,a=-100,l=!l):c<n&&(c=n)}return{sar:c}}))}},st={name:"VOL",shortName:"VOL",series:z.Volume,calcParams:[5,10,20],shouldFormatBigNumber:!0,precision:0,minValue:0,figures:[{key:"ma1",title:"MA5: ",type:"line"},{key:"ma2",title:"MA10: ",type:"line"},{key:"ma3",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,e,i)=>{const n=t.current.kLineData;let o;return o=n.close>n.open?d(e.styles,"bars[0].upColor",i.bars[0].upColor):n.close<n.open?d(e.styles,"bars[0].downColor",i.bars[0].downColor):d(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:o}}}],regenerateFigures:t=>{const e=t.map(((t,e)=>({key:`ma${e+1}`,title:`MA${t}: `,type:"line"})));return e.push({key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,styles:(t,e,i)=>{const n=t.current.kLineData;let o;return o=n.close>n.open?d(e.styles,"bars[0].upColor",i.bars[0].upColor):n.close<n.open?d(e.styles,"bars[0].downColor",i.bars[0].downColor):d(e.styles,"bars[0].noChangeColor",i.bars[0].noChangeColor),{color:o}}}),e},calc:(t,e)=>{const{calcParams:i,figures:n}=e,o=[];return t.map(((e,s)=>{var r;const a=null!==(r=e.volume)&&void 0!==r?r:0,l={volume:a};return i.forEach(((e,i)=>{var r,c;o[i]=(null!==(r=o[i])&&void 0!==r?r:0)+a,s>=e-1&&(l[n[i].key]=o[i]/e,o[i]-=null!==(c=t[s-(e-1)].volume)&&void 0!==c?c:0)})),l}))}},rt={name:"WR",shortName:"WR",calcParams:[6,10,14],figures:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`wr${e+1}`,title:`WR${e+1}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e;return t.map(((e,o)=>{const s={},r=e.close;return i.forEach(((e,i)=>{const a=e-1;if(o>=a){const e=R(t.slice(o-a,o+1),"high","low"),l=e[0],c=l-e[1];s[n[i].key]=0===c?0:(r-l)/c*100}})),s}))}},at={},lt=[H,$,{name:"BIAS",shortName:"BIAS",calcParams:[6,12,24],figures:[{key:"bias1",title:"BIAS6: ",type:"line"},{key:"bias2",title:"BIAS12: ",type:"line"},{key:"bias3",title:"BIAS24: ",type:"line"}],regenerateFigures:t=>t.map(((t,e)=>({key:`bias${e+1}`,title:`BIAS${t}: `,type:"line"}))),calc:(t,e)=>{const{calcParams:i,figures:n}=e,o=[];return t.map(((e,s)=>{const r={},a=e.close;return i.forEach(((e,l)=>{var c;if(o[l]=(null!==(c=o[l])&&void 0!==c?c:0)+a,s>=e-1){const c=o[l]/i[l];r[n[l].key]=(a-c)/c*100,o[l]-=t[s-(e-1)].close}})),r}))}},j,{name:"BRAR",shortName:"BRAR",calcParams:[26],figures:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,o=0,s=0,r=0;return t.map(((e,a)=>{var l,c;const h={},d=e.high,u=e.low,g=e.open,v=(null!==(l=t[a-1])&&void 0!==l?l:e).close;if(s+=d-g,r+=g-u,n+=d-v,o+=v-u,a>=i[0]-1){h.ar=0!==r?s/r*100:0,h.br=0!==o?n/o*100:0;const e=t[a-(i[0]-1)],l=e.high,d=e.low,u=e.open,g=(null!==(c=t[a-i[0]])&&void 0!==c?c:t[a-(i[0]-1)]).close;n-=l-g,o-=g-d,s-=l-u,r-=u-d}return h}))}},G,U,Z,q,K,{name:"EMV",shortName:"EMV",calcParams:[14,9],figures:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,o=0;const s=[],r=[];return t.forEach(((e,a)=>{var l,c,h;const d={},u=null!==(l=t[a-1])&&void 0!==l?l:e,g=e.high,v=e.low,m=null!==(c=e.turnover)&&void 0!==c?c:0,p=(g+v)/2,_=(u.high+u.low)/2;let x=0;0!==m&&(x=(p-_)*(g-v)/m),s.push(x),n+=x,a>=i[0]-1&&(d.emv=n,n-=s[a-(i[0]-1)],o+=d.emv,a>=i[0]+i[1]-2&&(d.maEmv=o/i[1],o-=null!==(h=r[a-(i[1]-1)].emv)&&void 0!==h?h:0)),r.push(d)})),r}},J,{name:"MTM",shortName:"MTM",calcParams:[12,6],figures:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0;const o=[];return t.forEach(((e,s)=>{var r;const a={};if(s>=i[0]){const l=e.close,c=t[s-i[0]].close;a.mtm=l-c,n+=a.mtm,s>=i[0]+i[1]-1&&(a.maMtm=n/i[1],n-=null!==(r=o[s-(i[1]-1)].mtm)&&void 0!==r?r:0)}o.push(a)})),o}},Q,tt,{name:"OBV",shortName:"OBV",calcParams:[30],figures:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,o=0;const s=[];return t.forEach(((e,r)=>{var a,l,c,h;const d=null!==(a=t[r-1])&&void 0!==a?a:e;e.close<d.close?o-=null!==(l=e.volume)&&void 0!==l?l:0:e.close>d.close&&(o+=null!==(c=e.volume)&&void 0!==c?c:0);const u={obv:o};n+=o,r>=i[0]-1&&(u.maObv=n/i[0],n-=null!==(h=s[r-(i[0]-1)].obv)&&void 0!==h?h:0),s.push(u)})),s}},{name:"PVT",shortName:"PVT",figures:[{key:"pvt",title:"PVT: ",type:"line"}],calc:t=>{let e=0;return t.map(((i,n)=>{var o,s;const r={},a=i.close,l=null!==(o=i.volume)&&void 0!==o?o:1,c=(null!==(s=t[n-1])&&void 0!==s?s:i).close;let h=0;const d=c*l;return 0!==d&&(h=(a-c)/d),e+=h,r.pvt=e,r}))}},{name:"PSY",shortName:"PSY",calcParams:[12,6],figures:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,o=0;const s=[],r=[];return t.forEach(((e,a)=>{var l,c;const h={},d=(null!==(l=t[a-1])&&void 0!==l?l:e).close,u=e.close-d>0?1:0;s.push(u),n+=u,a>=i[0]-1&&(h.psy=n/i[0]*100,o+=h.psy,a>=i[0]+i[1]-2&&(h.maPsy=o/i[1],o-=null!==(c=r[a-(i[1]-1)].psy)&&void 0!==c?c:0),n-=s[a-(i[0]-1)]),r.push(h)})),r}},{name:"ROC",shortName:"ROC",calcParams:[12,6],figures:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams,n=[];let o=0;return t.forEach(((e,s)=>{var r,a;const l={};if(s>=i[0]-1){const c=e.close,h=(null!==(r=t[s-i[0]])&&void 0!==r?r:t[s-(i[0]-1)]).close;l.roc=0!==h?(c-h)/h*100:0,o+=l.roc,s>=i[0]-1+i[1]-1&&(l.maRoc=o/i[1],o-=null!==(a=n[s-(i[1]-1)].roc)&&void 0!==a?a:0)}n.push(l)})),n}},et,it,nt,ot,{name:"TRIX",shortName:"TRIX",calcParams:[12,9],figures:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n,o,s,r=0,a=0,l=0,c=0;const h=[];return t.forEach(((t,e)=>{var d;const u={},g=t.close;if(r+=g,e>=i[0]-1&&(n=e>i[0]-1?(2*g+(i[0]-1)*n)/(i[0]+1):r/i[0],a+=n,e>=2*i[0]-2&&(o=e>2*i[0]-2?(2*n+(i[0]-1)*o)/(i[0]+1):a/i[0],l+=o,e>=3*i[0]-3))){let t,n=0;e>3*i[0]-3?(t=(2*o+(i[0]-1)*s)/(i[0]+1),n=(t-s)/s*100):t=l/i[0],s=t,u.trix=n,c+=n,e>=3*i[0]+i[1]-4&&(u.maTrix=c/i[1],c-=null!==(d=h[e-(i[1]-1)].trix)&&void 0!==d?d:0)}h.push(u)})),h}},st,{name:"VR",shortName:"VR",calcParams:[26,6],figures:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calc:(t,e)=>{const i=e.calcParams;let n=0,o=0,s=0,r=0;const a=[];return t.forEach(((e,l)=>{var c,h,d,u,g;const v={},m=e.close,p=(null!==(c=t[l-1])&&void 0!==c?c:e).close,_=null!==(h=e.volume)&&void 0!==h?h:0;if(m>p?n+=_:m<p?o+=_:s+=_,l>=i[0]-1){const e=s/2;v.vr=o+e===0?0:(n+e)/(o+e)*100,r+=v.vr,l>=i[0]+i[1]-2&&(v.maVr=r/i[1],r-=null!==(d=a[l-(i[1]-1)].vr)&&void 0!==d?d:0);const c=t[l-(i[0]-1)],h=null!==(u=t[l-i[0]])&&void 0!==u?u:c,m=c.close,p=null!==(g=c.volume)&&void 0!==g?g:0;m>h.close?n-=p:m<h.close?o-=p:s-=p}a.push(v)})),a}},rt];function ct(t){var e;return null!==(e=at[t])&&void 0!==e?e:null}lt.forEach((t=>{at[t.name]=X.extend(t)}));class ht{constructor(t){this._instances=new Map,this._chartStore=t}_overrideInstance(t,e){const{shortName:i,series:n,calcParams:o,precision:s,figures:r,minValue:a,maxValue:l,shouldOhlc:c,shouldFormatBigNumber:h,visible:d,styles:u,extendData:g,regenerateFigures:v,createTooltipDataSource:m,draw:p,calc:_}=e;let x=!1;void 0!==i&&t.setShortName(i)&&(x=!0),void 0!==n&&t.setSeries(n)&&(x=!0);let f=!1;return void 0!==o&&t.setCalcParams(o)&&(x=!0,f=!0),void 0!==r&&t.setFigures(r)&&(x=!0,f=!0),void 0!==a&&t.setMinValue(a)&&(x=!0),void 0!==l&&t.setMinValue(l)&&(x=!0),void 0!==s&&t.setPrecision(s)&&(x=!0),void 0!==c&&t.setShouldOhlc(c)&&(x=!0),void 0!==h&&t.setShouldFormatBigNumber(h)&&(x=!0),void 0!==d&&t.setVisible(d)&&(x=!0),void 0!==u&&t.setStyles(u)&&(x=!0),void 0!==g&&t.setExtendData(g)&&(x=!0,f=!0),void 0!==v&&t.setRegenerateFigures(v)&&(x=!0),void 0!==m&&t.setCreateTooltipDataSource(m)&&(x=!0),void 0!==p&&t.setDraw(p)&&(x=!0),void 0!==_&&(t.calc=_,f=!0),[x,f]}async addInstance(t,e,i){var n;const{name:o}=t;let s=this._instances.get(e);if(null!==(n=null==s?void 0:s.has(o))&&void 0!==n&&n)return await Promise.reject(new Error("Duplicate indicators."));void 0===s&&(s=new Map,this._instances.set(e,s));const r=new(ct(o));return this._overrideInstance(r,t),i||s.clear(),s.set(o,r),await r.calcIndicator(this._chartStore.getDataList())}getInstances(t){var e;return null!==(e=this._instances.get(t))&&void 0!==e?e:new Map}removeInstance(t,e){let i=!1;const n=this._instances.get(t);return void 0!==n&&(void 0!==e?n.has(e)&&(n.delete(e),i=!0):(n.clear(),i=!0),0===n.size&&this._instances.delete(t)),i}hasInstances(t){return this._instances.has(t)}async calcInstance(t,e){var i;const n=[];if(void 0!==t)if(void 0!==e){const o=this._instances.get(e);if(null!==(i=null==o?void 0:o.has(t))&&void 0!==i&&i){const e=null==o?void 0:o.get(t);n.push(e.calcIndicator(this._chartStore.getDataList()))}}else this._instances.forEach((e=>{if(e.has(t)){const i=null==e?void 0:e.get(t);n.push(i.calcIndicator(this._chartStore.getDataList()))}}));else this._instances.forEach((t=>{t.forEach((t=>{n.push(t.calcIndicator(this._chartStore.getDataList()))}))}));return(await Promise.all(n)).includes(!0)}getInstanceByPaneId(t,e){var i;if(void 0!==t){const n=this._instances.get(t);return void 0!==e?null!==(i=null==n?void 0:n.get(e))&&void 0!==i?i:null:null!=n?n:null}return this._instances}setSeriesPrecision(t){this._instances.forEach((e=>{e.forEach((e=>{e.series===z.Price&&e.setPrecision(t.price,!0),e.series===z.Volume&&e.setPrecision(t.volume,!0)}))}))}async override(t,e){const{name:i}=t;let n=new Map;if(null!==e){const t=this._instances.get(e);void 0!==t&&n.set(e,t)}else n=this._instances;let o=!1;const s=[];n.forEach((e=>{const n=e.get(i);if(void 0!==n){const e=this._overrideInstance(n,t);e[1]?s.push(n.calcIndicator(this._chartStore.getDataList())):e[0]&&(o=!0)}}));const r=await Promise.all(s);return[o,r.includes(!0)]}}class dt{constructor(t){this._crosshair={},this._chartStore=t}set(t,e){const i=this._chartStore.getDataList(),n=null!=t?t:{};let o,s;void 0!==n.x?(o=this._chartStore.getTimeScaleStore().coordinateToDataIndex(n.x),s=o<0?0:o>i.length-1?i.length-1:o):(o=i.length-1,s=o);const r=i[s],a=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(o),l=this._crosshair.x,c=this._crosshair.y,h=this._crosshair.paneId;return this._crosshair={...n,realX:a,kLineData:r,realDataIndex:o,dataIndex:s},l===n.x&&c===n.y&&h===n.paneId||(null!==r&&this._chartStore.getChart().crosshairChange(this._crosshair),null!=e&&e||this._chartStore.getChart().updatePane(1)),this}recalculate(t){this.set(this._crosshair,t)}get(){return this._crosshair}}class ut{constructor(t){this._activeIconInfo={paneId:"",indicatorName:"",iconId:""},this._chartStore=t}setActiveIconInfo(t){this._activeIconInfo=void 0===t?{paneId:"",indicatorName:"",iconId:""}:t}getActiveIconInfo(){var t;return null!==(t=this._activeIconInfo)&&void 0!==t?t:null}}var gt;!function(t){t.Normal="normal",t.WeakMagnet="weak_magnet",t.StrongMagnet="strong_magnet"}(gt||(gt={}));class vt{constructor(t){this.currentStep=1,this.points=[],this._prevPressedPoint=null,this._prevPressedPoints=[];const{mode:e,extendData:i,styles:n,name:o,totalStep:s,lock:r,visible:a,needDefaultPointFigure:l,needDefaultXAxisFigure:c,needDefaultYAxisFigure:h,createPointFigures:d,createXAxisFigures:u,createYAxisFigures:g,performEventPressedMove:v,performEventMoveForDrawing:m,onDrawStart:p,onDrawing:_,onDrawEnd:x,onClick:f,onRightClick:y,onPressedMoveStart:S,onPressedMoving:C,onPressedMoveEnd:b,onMouseEnter:w,onMouseLeave:I,onRemoved:E,onSelected:T,onDeselected:D}=t;this.name=o,this.totalStep=void 0===s||s<2?1:s,this.lock=null!=r&&r,this.visible=null==a||a,this.needDefaultPointFigure=null!=l&&l,this.needDefaultXAxisFigure=null!=c&&c,this.needDefaultYAxisFigure=null!=h&&h,this.mode=null!=e?e:gt.Normal,this.extendData=i,this.styles=null!=n?n:null,this.createPointFigures=null!=d?d:null,this.createXAxisFigures=null!=u?u:null,this.createYAxisFigures=null!=g?g:null,this.performEventPressedMove=null!=v?v:null,this.performEventMoveForDrawing=null!=m?m:null,this.onDrawStart=null!=p?p:null,this.onDrawing=null!=_?_:null,this.onDrawEnd=null!=x?x:null,this.onClick=null!=f?f:null,this.onRightClick=null!=y?y:null,this.onPressedMoveStart=null!=S?S:null,this.onPressedMoving=null!=C?C:null,this.onPressedMoveEnd=null!=b?b:null,this.onMouseEnter=null!=w?w:null,this.onMouseLeave=null!=I?I:null,this.onRemoved=null!=E?E:null,this.onSelected=null!=T?T:null,this.onDeselected=null!=D?D:null}setId(t){return void 0===this.id&&(this.id=t,!0)}setGroupId(t){return void 0===this.groupId&&(this.groupId=t,!0)}setExtendData(t){return t!==this.extendData&&(this.extendData=t,!0)}setStyles(t){return t!==this.styles&&(this.styles=t,!0)}setPoints(t){if(t.length>0){let e;if(this.points=[...t],t.length>=this.totalStep-1?(this.currentStep=-1,e=this.totalStep-1):(this.currentStep=t.length+1,e=t.length),null!==this.performEventMoveForDrawing)for(let t=0;t<e;t++)this.performEventMoveForDrawing({currentStep:t+2,mode:this.mode,points:this.points,performPointIndex:t,performPoint:this.points[t]});return-1===this.currentStep&&null!==this.performEventPressedMove&&this.performEventPressedMove({currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:this.points.length-1,performPoint:this.points[this.points.length-1]}),!0}return!1}setLock(t){return this.lock!==t&&(this.lock=t,!0)}setVisible(t){return this.visible!==t&&(this.visible=t,!0)}setMode(t){return t!==this.mode&&(this.mode=t,!0)}setOnDrawStartCallback(t){return this.onDrawStart!==t&&(this.onDrawStart=t,!0)}setOnDrawingCallback(t){return this.onDrawing!==t&&(this.onDrawing=t,!0)}setOnDrawEndCallback(t){return this.onDrawEnd!==t&&(this.onDrawEnd=t,!0)}setOnClickCallback(t){return this.onClick!==t&&(this.onClick=t,!0)}setOnRightClickCallback(t){return this.onRightClick!==t&&(this.onRightClick=t,!0)}setOnPressedMoveStartCallback(t){return this.onPressedMoveStart!==t&&(this.onPressedMoveStart=t,!0)}setOnPressedMovingCallback(t){return this.onPressedMoving!==t&&(this.onPressedMoving=t,!0)}setOnPressedMoveEndCallback(t){return this.onPressedMoveEnd!==t&&(this.onPressedMoveEnd=t,!0)}setOnMouseEnterCallback(t){return this.onMouseEnter!==t&&(this.onMouseEnter=t,!0)}setOnMouseLeaveCallback(t){return this.onMouseLeave!==t&&(this.onMouseLeave=t,!0)}setOnRemovedCallback(t){return this.onRemoved!==t&&(this.onRemoved=t,!0)}setOnSelectedCallback(t){return this.onSelected!==t&&(this.onSelected=t,!0)}setOnDeselectedCallback(t){return this.onDeselected!==t&&(this.onDeselected=t,!0)}nextStep(){this.currentStep===this.totalStep-1?this.currentStep=-1:this.currentStep++}isDrawing(){return-1!==this.currentStep}isStart(){return 1===this.currentStep}eventMoveForDrawing(t){var e;const i=this.currentStep-1,n={};void 0!==t.timestamp&&(n.timestamp=t.timestamp),void 0!==t.dataIndex&&(n.dataIndex=t.dataIndex),void 0!==t.value&&(n.value=t.value),this.points[i]=n,null===(e=this.performEventMoveForDrawing)||void 0===e||e.call(this,{currentStep:this.currentStep,mode:this.mode,points:this.points,performPointIndex:i,performPoint:n})}eventPressedPointMove(t,e){var i;void 0!==t.dataIndex&&(this.points[e].dataIndex=t.dataIndex,this.points[e].timestamp=t.timestamp),void 0!==t.value&&(this.points[e].value=t.value),null===(i=this.performEventPressedMove)||void 0===i||i.call(this,{currentStep:this.currentStep,points:this.points,mode:this.mode,performPointIndex:e,performPoint:this.points[e]})}startPressedMove(t){this._prevPressedPoint={...t},this._prevPressedPoints=i(this.points)}eventPressedOtherMove(t,e){if(null!==this._prevPressedPoint){let i,n;void 0!==t.dataIndex&&void 0!==this._prevPressedPoint.dataIndex&&(i=t.dataIndex-this._prevPressedPoint.dataIndex),void 0!==t.value&&void 0!==this._prevPressedPoint.value&&(n=t.value-this._prevPressedPoint.value),this.points=this._prevPressedPoints.map((t=>{var o;void 0===t.dataIndex&&void 0!==t.timestamp&&(t.dataIndex=e.timestampToDataIndex(t.timestamp));const s={...t};return void 0!==i&&void 0!==t.dataIndex&&(s.dataIndex=t.dataIndex+i,s.timestamp=null!==(o=e.dataIndexToTimestamp(s.dataIndex))&&void 0!==o?o:void 0),void 0!==n&&void 0!==t.value&&(s.value=t.value+n),s}))}}static extend(t){return class extends vt{constructor(){super(t)}}}}function mt(t,e){return Math.sqrt(Math.pow(t.x+e.x,2)+Math.pow(t.y+e.y,2))}function pt(t){const e=mt(t[0],t[1]),i=e+mt(t[1],t[2]),n=[t[2].x-t[0].x,t[2].y-t[0].y];return[{x:t[1].x-.5*n[0]*e/i,y:t[1].y-.5*n[1]*e/i},{x:t[1].x+.5*n[0]*e/i,y:t[1].y+.5*n[1]*e/i}]}function _t(t,e){let i=!1;const n=e.coordinates;if(n.length>1)for(let o=1;o<n.length;o++){const e=n[o-1],s=n[o];if(e.x===s.x)i=Math.abs(t.x-e.x)<2;else{const n=yt(e,s),o=xt(n,t),r=Math.abs(o-t.y);i=r*r/(n[0]*n[0]+1)<4}if(i)return i}return i}function xt(t,e){return null!=t?e.x*t[0]+t[1]:e.y}function ft(t,e,i){return xt(yt(t,e),i)}function yt(t,e){const i=t.x-e.x;if(0!==i){const n=(t.y-e.y)/i;return[n,t.y-n*t.x]}return null}function St(t,e,i){const{coordinates:n}=e,o=n.length;if(o>1){const{style:e=m.Solid,smooth:s,size:r=1,color:a="currentColor",dashedValue:l=[2,2]}=i;if(t.lineWidth=r,t.strokeStyle=a,e===m.Dashed?t.setLineDash(l):t.setLineDash([]),t.beginPath(),t.moveTo(n[0].x,n[0].y),null!=s&&s){let e=[];for(let t=1;t<o-1;t++)e=e.concat(pt([n[t-1],n[t],n[t+1]]));t.quadraticCurveTo(e[0].x,e[0].y,n[1].x,n[1].y);let i=2;for(;i<o-1;i++)t.bezierCurveTo(e[2*(i-2)+1].x,e[2*(i-2)+1].y,e[2*(i-1)].x,e[2*(i-1)].y,n[i].x,n[i].y);t.quadraticCurveTo(e[2*(i-2)+1].x,e[2*(i-2)+1].y,n[i].x,n[i].y)}else for(let i=1;i<n.length;i++)t.lineTo(n[i].x,n[i].y);t.stroke(),t.closePath()}}const Ct={name:"line",checkEventOn:_t,draw:(t,e,i)=>{St(t,e,i)}};function bt(t,e,i){const n=null!=i?i:0,o=[];if(t.length>1)if(t[0].x===t[1].x){const i=0,s=e.height;if(o.push({coordinates:[{x:t[0].x,y:i},{x:t[0].x,y:s}]}),t.length>2){o.push({coordinates:[{x:t[2].x,y:i},{x:t[2].x,y:s}]});const e=t[0].x-t[2].x;for(let r=0;r<n;r++){const n=e*(r+1);o.push({coordinates:[{x:t[0].x+n,y:i},{x:t[0].x+n,y:s}]})}}}else{const i=0,s=e.width,r=yt(t[0],t[1]),a=r[0],l=r[1];if(o.push({coordinates:[{x:i,y:i*a+l},{x:s,y:s*a+l}]}),t.length>2){const e=t[2].y-a*t[2].x;o.push({coordinates:[{x:i,y:i*a+e},{x:s,y:s*a+e}]});const r=l-e;for(let t=0;t<n;t++){const e=l+r*(t+1);o.push({coordinates:[{x:i,y:i*a+e},{x:s,y:s*a+e}]})}}}return o}function wt(t,e){if(t.length>1){let i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[0].y<t[1].y?{x:t[0].x,y:e.height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:ft(t[0],t[1],{x:0,y:t[0].y})}:{x:e.width,y:ft(t[0],t[1],{x:e.width,y:t[0].y})},{coordinates:[t[0],i]}}return[]}const It={name:"simpleAnnotation",createPointFigures:({overlay:t,coordinates:e})=>{var i;let n;a(t.extendData)&&(n=o(t.extendData)?t.extendData(t):null!==(i=t.extendData)&&void 0!==i?i:"");const s=e[0].x,r=e[0].y-6,l=r-50,c=l-5;return[{type:"line",attrs:{coordinates:[{x:s,y:r},{x:s,y:l}]},ignoreEvent:!0},{type:"polygon",attrs:{coordinates:[{x:s,y:l},{x:s-4,y:c},{x:s+4,y:c}]},ignoreEvent:!0},{type:"rectText",attrs:{x:s,y:c,text:null!=n?n:"",align:"center",baseline:"bottom"},ignoreEvent:!0}]}},Et={name:"simpleTag",createPointFigures:({bounding:t,coordinates:e})=>({type:"line",attrs:{coordinates:[{x:0,y:e[0].y},{x:t.width,y:e[0].y}]},ignoreEvent:!0}),createYAxisFigures:({overlay:t,coordinates:e,bounding:i,yAxis:n,precision:s})=>{var r,l;let c,h,d;return null!==(r=null==n?void 0:n.isFromZero())&&void 0!==r&&r?(c="left",h=0):(c="right",h=i.width),a(t.extendData)&&(d=o(t.extendData)?t.extendData(t):null!==(l=t.extendData)&&void 0!==l?l:""),a(d)||void 0===t.points[0].value||(d=g(t.points[0].value,s.price)),{type:"rectText",attrs:{x:h,y:e[0].y,text:null!=d?d:"",align:c,baseline:"middle"}}}},Tt={};function Dt(t){var e;return null!==(e=Tt[t])&&void 0!==e?e:null}function Mt(t){const i={width:0,height:0,left:0,right:0,top:0,bottom:0};return void 0!==t&&e(i,t),i}[{name:"fibonacciLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,overlay:i,precision:n})=>{const o=i.points;if(t.length>0){const i=[],s=[],r=0,a=e.width;if(t.length>1&&void 0!==o[0].value&&void 0!==o[1].value){const e=[1,.786,.618,.5,.382,.236,0],l=t[0].y-t[1].y,c=o[0].value-o[1].value;e.forEach((e=>{var h;const d=t[1].y+l*e,u=((null!==(h=o[1].value)&&void 0!==h?h:0)+c*e).toFixed(n.price);i.push({coordinates:[{x:r,y:d},{x:a,y:d}]}),s.push({x:r,y:d,text:`${u} (${(100*e).toFixed(1)}%)`,baseline:"bottom"})}))}return[{type:"line",attrs:i},{type:"text",isCheckEvent:!1,attrs:s}]}return[]}},{name:"horizontalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{const i={x:0,y:t[0].y};return void 0!==t[1]&&t[0].x<t[1].x&&(i.x=e.width),[{type:"line",attrs:{coordinates:[t[0],i]}}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>{const e=[];return 2===t.length&&e.push({coordinates:t}),[{type:"line",attrs:e}]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].value=e.value,t[1].value=e.value},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].value=i.value)}},{name:"horizontalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:0,y:t[0].y},{x:e.width,y:t[0].y}]}}]},{name:"parallelStraightLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:bt(t,e)}]},{name:"priceChannelLine",totalStep:4,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:bt(t,e,1)}]},{name:"priceLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e,precision:i,overlay:n})=>{const{value:o=0}=n.points[0];return[{type:"line",attrs:{coordinates:[t[0],{x:e.width,y:t[0].y}]}},{type:"text",isCheck:!1,attrs:{x:t[0].x,y:t[0].y,text:o.toFixed(i.price),baseline:"bottom"}}]}},{name:"rayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:wt(t,e)}]},{name:"segment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[]},{name:"straightLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>2===t.length?t[0].x===t[1].x?[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]:[{type:"line",attrs:{coordinates:[{x:0,y:ft(t[0],t[1],{x:0,y:t[0].y})},{x:e.width,y:ft(t[0],t[1],{x:e.width,y:t[0].y})}]}}]:[]},{name:"verticalRayLine",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>{if(2===t.length){const i={x:t[0].x,y:0};return t[0].y<t[1].y&&(i.y=e.height),[{type:"line",attrs:{coordinates:[t[0],i]}}]}return[]},performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalSegment",totalStep:3,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t})=>2===t.length?[{type:"line",attrs:{coordinates:t}}]:[],performEventPressedMove:({points:t,performPoint:e})=>{t[0].timestamp=e.timestamp,t[0].dataIndex=e.dataIndex,t[1].timestamp=e.timestamp,t[1].dataIndex=e.dataIndex},performEventMoveForDrawing:({currentStep:t,points:e,performPoint:i})=>{2===t&&(e[0].timestamp=i.timestamp,e[0].dataIndex=i.dataIndex)}},{name:"verticalStraightLine",totalStep:2,needDefaultPointFigure:!0,needDefaultXAxisFigure:!0,needDefaultYAxisFigure:!0,createPointFigures:({coordinates:t,bounding:e})=>[{type:"line",attrs:{coordinates:[{x:t[0].x,y:0},{x:t[0].x,y:e.height}]}}]},It,Et].forEach((t=>{Tt[t.name]=vt.extend(t)}));class Pt{constructor(){this._children=[],this._callbacks=new Map}registerEvent(t,e){return this._callbacks.set(t,e),this}onEvent(t,e,i){const n=this._callbacks.get(t);return!(void 0===n||!this.checkEventOn(e))&&n(e,i)}checkEventOn(t){for(const e of this._children)if(e.checkEventOn(t))return!0;return!1}dispatchEvent(t,e,i){const n=this._children.length-1;if(n>-1)for(let o=n;o>-1;o--)if(this._children[o].dispatchEvent(t,e,i))return!0;return this.onEvent(t,e,i)}addChild(t){return this._children.push(t),this}clear(){this._children=[]}}const kt="main",At="xAxis",Ft="yAxis",Lt="separator";class Rt extends Pt{constructor(t,e){super(),this._bounding=Mt(),this._pane=e,this._init(t)}_init(t){if(this._container=D("div",this.getContainerStyle()),this.insertBefore()){const e=t.lastChild;null!==e?t.insertBefore(this._container,e):t.appendChild(this._container)}else t.appendChild(this._container);this.initDom(this._container)}setBounding(t){return e(this._bounding,t),this}getContainer(){return this._container}getBounding(){return this._bounding}getPane(){return this._pane}update(t){this.updateImp(t,this._container,this._bounding)}insertBefore(){return!1}}class Bt extends Rt{constructor(t,e){super(t,e),this._dragFlag=!1,this._dragStartY=0,this._topPaneHeight=0,this._currentPaneHeight=0,this._pressedMouseMoveEvent=function(t,e){let i=0;return function(){const n=Date.now();n-i>(null!=e?e:20)&&(t.apply(this,arguments),i=n)}}(this._pressedTouchMouseMoveEvent,20),this.registerEvent("touchStartEvent",this._mouseDownEvent.bind(this)).registerEvent("touchMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("touchEndEvent",this._mouseUpEvent.bind(this)).registerEvent("mouseDownEvent",this._mouseDownEvent.bind(this)).registerEvent("mouseUpEvent",this._mouseUpEvent.bind(this)).registerEvent("pressedMouseMoveEvent",this._pressedMouseMoveEvent.bind(this)).registerEvent("mouseEnterEvent",this._mouseEnterEvent.bind(this)).registerEvent("mouseLeaveEvent",this._mouseLeaveEvent.bind(this))}getName(){return Lt}checkEventOn(){return!0}_mouseDownEvent(t){var e,i;this._dragFlag=!0,this._dragStartY=t.pageY;const n=this.getPane();return this._topPaneHeight=null!==(i=null===(e=n.getTopPane())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,this._currentPaneHeight=n.getBounding().height,!0}_mouseUpEvent(){return this._dragFlag=!1,this._mouseLeaveEvent()}_pressedTouchMouseMoveEvent(t){const e=t.pageY-this._dragStartY,i=this.getPane(),n=i.getTopPane(),o=e<0;if(null!==n&&i.getOptions().dragEnabled){let t,s,r,a;o?(t=n,s=i,r=this._topPaneHeight,a=this._currentPaneHeight):(t=i,s=n,r=this._currentPaneHeight,a=this._topPaneHeight);const l=t.getOptions().minHeight;if(r>l){const n=Math.max(r-Math.abs(e),l),o=r-n;t.setBounding({height:n}),s.setBounding({height:a+o});const c=i.getChart();c.getChartStore().getActionStore().execute(w.OnPaneDrag,{paneId:i.getId}),c.adjustPaneViewport(!0,!0,!0,!0,!0)}}return!0}_mouseEnterEvent(){const t=this.getPane();if(t.getOptions().dragEnabled){const e=t.getChart().getStyles().separator;return this._moveDom.style.background=e.activeBackgroundColor,!0}return!1}_mouseLeaveEvent(){return!this._dragFlag&&(this._moveDom.style.background="",!0)}getContainerStyle(){return{margin:"0",padding:"0",position:"relative",boxSizing:"border-box"}}insertBefore(){return!0}initDom(t){this._moveDom=D("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20",boxSizing:"border-box",cursor:"ns-resize"}),t.appendChild(this._moveDom)}updateImp(t,e,i){if(4===t||2===t){const t=this.getPane().getChart().getStyles().separator;this._moveDom.style.top=-Math.floor((7-t.size)/2)+"px",this._moveDom.style.height="7px";const n=t.fill;e.style.backgroundColor=t.color,e.style.height=`${t.size}px`,e.style.marginLeft=`${n?0:i.left}px`,e.style.width=n?"100%":`${i.width}px`}}getImage(){const t=this.getPane().getChart().getStyles().separator,e=this.getContainer().offsetWidth,i=t.size,n=D("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),o=n.getContext("2d"),s=P(n);return n.width=e*s,n.height=i*s,o.scale(s,s),o.fillStyle=t.color,o.fillRect(this.getBounding().left,0,e,i),n}}const Nt={CANDLE:"candle_pane",INDICATOR:"indcator_pane_",XAXIS:"xaxis_pane"};class Vt{constructor(t,e,i,n,o){this._yAxisWidget=null,this._separatorWidget=null,this._axis=this.createAxisComponent(),this._bounding=Mt(),this._options={minHeight:30,dragEnabled:!0,gap:{top:.2,bottom:.1}},this._chart=e,this._id=i,this._topPane=null!=n?n:null,this._bottomPane=null!=o?o:null,this._init(t)}_init(t){this._container=t,this._seriesContiainer=D("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden",boxSizing:"border-box"}),this._separatorWidget=this.createSeparatorWidget(t);const e=t.lastChild;null!==e?t.insertBefore(this._seriesContiainer,e):t.appendChild(this._seriesContiainer),this._mainWidget=this.createMainWidget(this._seriesContiainer),this._yAxisWidget=this.creatYAxisWidget(this._seriesContiainer)}getContainer(){return this._seriesContiainer}getId(){return this._id}setOptions(t){return e(this._options,t),this}getOptions(){return this._options}getChart(){return this._chart}getAxisComponent(){return this._axis}setBounding(t,i,n){var o,s,r;e(this._bounding,t);let a=0;if(null!==this._separatorWidget){a=this._chart.getStyles().separator.size;const e={...t,height:7};void 0!==t.top&&(e.top=t.top-Math.floor((7-a)/2)),this._separatorWidget.setBounding(e)}const l={};return void 0!==t.height&&(l.height=t.height-a),void 0!==t.top&&(l.top=t.top+a),this._mainWidget.setBounding(l),null===(o=this._yAxisWidget)||void 0===o||o.setBounding(l),void 0!==i&&(this._mainWidget.setBounding(i),null===(s=this._separatorWidget)||void 0===s||s.setBounding(i)),void 0!==n&&(null===(r=this._yAxisWidget)||void 0===r||r.setBounding(n)),this}getTopPane(){return this._topPane}setTopPane(t){return this._topPane=t,this}getBottomPane(){return this._bottomPane}setBottomPane(t){return this._bottomPane=t,this}getBounding(){return this._bounding}getMainWidget(){return this._mainWidget}getYAxisWidget(){return this._yAxisWidget}getSeparatorWidget(){return this._separatorWidget}update(t){var e,i;this._bounding.width!==this._seriesContiainer.offsetWidth&&(this._seriesContiainer.style.width=`${this._bounding.width}px`);const n=this._mainWidget.getBounding().height;n!==this._seriesContiainer.offsetHeight&&(this._seriesContiainer.style.height=`${n}px`);const o=null!=t?t:3;this._mainWidget.update(o),null===(e=this._yAxisWidget)||void 0===e||e.update(o),null===(i=this._separatorWidget)||void 0===i||i.update(o)}getImage(t){const{width:e,height:i}=this._bounding,n=D("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),o=n.getContext("2d"),s=P(n);n.width=e*s,n.height=i*s,o.scale(s,s);let r=0;if(null!=this._separatorWidget){const t=this.getChart().getStyles().separator.size;r=t,o.drawImage(this._separatorWidget.getImage(),0,0,e,t)}const a=this._mainWidget.getBounding();if(o.drawImage(this._mainWidget.getImage(t),a.left,r,a.width,a.height),null!==this._yAxisWidget){const e=this._yAxisWidget.getBounding();o.drawImage(this._yAxisWidget.getImage(t),e.left,r,e.width,e.height)}return n}destroy(){this._container.removeChild(this._seriesContiainer),null!==this._separatorWidget&&this._container.removeChild(this._separatorWidget.getContainer())}createSeparatorWidget(t){return null}creatYAxisWidget(t){return null}}class Ot{constructor(t){this._instances=new Map,this._progressInstanceInfo=null,this._pressedInstanceInfo={paneId:"",instance:null,figureType:0,figureIndex:-1,attrsIndex:-1},this._hoverInstanceInfo={paneId:"",instance:null,figureType:0,figureIndex:-1,attrsIndex:-1},this._clickInstanceInfo={paneId:"",instance:null,figureType:0,figureIndex:-1,attrsIndex:-1},this._chartStore=t}_overrideInstance(t,e){const{id:i,groupId:n,points:o,styles:s,lock:r,visible:a,mode:l,extendData:c,onDrawStart:h,onDrawing:d,onDrawEnd:u,onClick:g,onRightClick:v,onPressedMoveStart:m,onPressedMoving:p,onPressedMoveEnd:_,onMouseEnter:x,onMouseLeave:f,onRemoved:y,onSelected:S,onDeselected:C}=e;let b=!1;return void 0!==i&&t.setId(i),void 0!==n&&t.setGroupId(n),void 0!==o&&t.setPoints(o)&&(b=!0),void 0!==s&&t.setStyles(s)&&(b=!0),void 0!==r&&t.setLock(r),void 0!==a&&t.setVisible(a)&&(b=!0),void 0!==l&&t.setMode(l),void 0!==c&&t.setExtendData(c)&&(b=!0),void 0!==h&&t.setOnDrawStartCallback(h),void 0!==d&&t.setOnDrawingCallback(d),void 0!==u&&t.setOnDrawEndCallback(u),void 0!==g&&t.setOnClickCallback(g),void 0!==v&&t.setOnRightClickCallback(v),void 0!==m&&t.setOnPressedMoveStartCallback(m),void 0!==p&&t.setOnPressedMovingCallback(p),void 0!==_&&t.setOnPressedMoveEndCallback(_),void 0!==x&&t.setOnMouseEnterCallback(x),void 0!==f&&t.setOnMouseLeaveCallback(f),void 0!==y&&t.setOnRemovedCallback(y),void 0!==S&&t.setOnSelectedCallback(S),void 0!==C&&t.setOnDeselectedCallback(C),b}getInstanceById(t){for(const e of this._instances){const i=e[1].find((e=>e.id===t));if(void 0!==i)return i}return null!==this._progressInstanceInfo&&this._progressInstanceInfo.instance.id===t?this._progressInstanceInfo.instance:null}addInstance(t,e,i){var n,o,s,r;const a=null!==(n=t.id)&&void 0!==n?n:T("overlay_");if(null===this.getInstanceById(a)){const n=new(Dt(t.name)),l=null!==(o=t.groupId)&&void 0!==o?o:a;return t.id=a,t.groupId=l,this._overrideInstance(n,t),n.isDrawing()?this._progressInstanceInfo={paneId:e,instance:n,appointPaneFlag:i}:(this._instances.has(e)||this._instances.set(e,[]),null===(s=this._instances.get(e))||void 0===s||s.push(n)),null===(r=n.onDrawStart)||void 0===r||r.call(n,{overlay:n}),this._chartStore.getChart().updatePane(1,e),a}return null}getProgressInstanceInfo(){return this._progressInstanceInfo}progressInstanceComplete(){var t;if(null!==this._progressInstanceInfo){const{instance:e,paneId:i}=this._progressInstanceInfo;e.isDrawing()||(this._instances.has(i)||this._instances.set(i,[]),null===(t=this._instances.get(i))||void 0===t||t.push(e),this._progressInstanceInfo=null)}}updateProgressInstanceInfo(t,e){null!==this._progressInstanceInfo&&(void 0!==e&&e&&(this._progressInstanceInfo.appointPaneFlag=e),this._progressInstanceInfo.paneId=t)}getInstances(t){var e;if(void 0===t){let t=[];return this._instances.forEach((e=>{t=t.concat(e)})),t}return null!==(e=this._instances.get(t))&&void 0!==e?e:[]}override(t){const{id:e,groupId:i,name:n}=t;let o=!1;if(void 0!==e){const i=this.getInstanceById(e);null!==i&&this._overrideInstance(i,t)&&(o=!0)}else if(this._instances.forEach((e=>{e.forEach((e=>{(void 0!==n&&e.name===n||void 0!==i&&e.groupId===i||void 0===n&&void 0===i)&&this._overrideInstance(e,t)&&(o=!0)}))})),null!==this._progressInstanceInfo){const e=this._progressInstanceInfo.instance;(void 0!==n&&e.name===n||void 0!==i&&e.groupId===i||void 0===n&&void 0===i)&&this._overrideInstance(e,t)&&(o=!0)}o&&this._chartStore.getChart().updatePane(1)}removeInstance(t){var e;const i=(t,e)=>{if(void 0!==t.id){if(e.id!==t.id)return!1}else if(void 0!==t.groupId){if(e.groupId!==t.groupId)return!1}else if(void 0!==t.name&&e.name!==t.name)return!1;return!0},n=[];if(null!==this._progressInstanceInfo){const o=this._progressInstanceInfo.instance;(void 0===t||void 0!==t&&i(t,o))&&(n.push(this._progressInstanceInfo.paneId),null===(e=o.onRemoved)||void 0===e||e.call(o,{overlay:o}),this._progressInstanceInfo=null)}if(void 0!==t){const e=new Map;for(const o of this._instances){const s=o[1].filter((e=>{var s;return!i(t,e)||(n.includes(o[0])||n.push(o[0]),null===(s=e.onRemoved)||void 0===s||s.call(e,{overlay:e}),!1)}));s.length>0&&e.set(o[0],s)}this._instances=e}else this._instances.forEach(((t,e)=>{n.push(e),t.forEach((t=>{var e;null===(e=t.onRemoved)||void 0===e||e.call(t,{overlay:t})}))})),this._instances.clear();if(n.length>0){const t=this._chartStore.getChart();n.forEach((e=>{t.updatePane(1,e)})),t.updatePane(1,Nt.XAXIS)}}setPressedInstanceInfo(t){this._pressedInstanceInfo=t}getPressedInstanceInfo(){return this._pressedInstanceInfo}setHoverInstanceInfo(t,e){var i,n,o,s,r;const{instance:a,figureType:l,figureIndex:c}=this._hoverInstanceInfo;(null==a?void 0:a.id)===(null===(i=t.instance)||void 0===i?void 0:i.id)&&l===t.figureType&&c===t.figureIndex||(this._hoverInstanceInfo=t,(null==a?void 0:a.id)!==(null===(n=t.instance)||void 0===n?void 0:n.id)&&(null===(o=null==a?void 0:a.onMouseLeave)||void 0===o||o.call(a,{overlay:a,...e}),null===(r=null===(s=t.instance)||void 0===s?void 0:s.onMouseEnter)||void 0===r||r.call(s,{overlay:t.instance,...e})))}getHoverInstanceInfo(){return this._hoverInstanceInfo}setClickInstanceInfo(t,e){var i,n,o,s,r,a,l,c,h;const{paneId:d,instance:u,figureType:g,figureIndex:v}=this._clickInstanceInfo;if(null!==(n=null===(i=t.instance)||void 0===i?void 0:i.isDrawing())&&void 0!==n&&n||null===(s=null===(o=t.instance)||void 0===o?void 0:o.onClick)||void 0===s||s.call(o,{overlay:t.instance,...e}),((null==u?void 0:u.id)!==(null===(r=t.instance)||void 0===r?void 0:r.id)||g!==t.figureType||v!==t.figureIndex)&&(this._clickInstanceInfo=t,(null==u?void 0:u.id)!==(null===(a=t.instance)||void 0===a?void 0:a.id))){null===(l=null==u?void 0:u.onDeselected)||void 0===l||l.call(u,{overlay:u,...e}),null===(h=null===(c=t.instance)||void 0===c?void 0:c.onSelected)||void 0===h||h.call(c,{overlay:t.instance,...e});const i=this._chartStore.getChart();i.updatePane(1,t.paneId),d!==t.paneId&&i.updatePane(1,d),i.updatePane(1,Nt.XAXIS)}}getClickInstanceInfo(){return this._clickInstanceInfo}isEmpty(){return 0===this._instances.size&&null===this._progressInstanceInfo}isDrawing(){var t,e;return null!==this._progressInstanceInfo&&null!==(e=null===(t=this._progressInstanceInfo)||void 0===t?void 0:t.instance.isDrawing())&&void 0!==e&&e}}class Wt{constructor(){this._actions=new Map}execute(t,e){var i;null===(i=this._actions.get(t))||void 0===i||i.execute(e)}subscribe(t,e){var i;this._actions.has(t)||this._actions.set(t,new I),null===(i=this._actions.get(t))||void 0===i||i.subscribe(e)}unsubscribe(t,e){const i=this._actions.get(t);void 0!==i&&(i.unsubscribe(e),i.isEmpty()&&this._actions.delete(t))}has(t){const e=this._actions.get(t);return void 0!==e&&!e.isEmpty()}}const zt={light:{grid:{horizontal:{color:"#EDEDED"},vertical:{color:"#EDEDED"}},candle:{priceMark:{high:{color:"#76808F"},low:{color:"#76808F"}},tooltip:{rect:{color:"#FEFEFE",borderColor:"#F2F3F5"},text:{color:"#76808F"}}},indicator:{tooltip:{text:{color:"#76808F"}}},xAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},yAxis:{axisLine:{color:"#DDDDDD"},tickText:{color:"#76808F"},tickLine:{color:"#DDDDDD"}},separator:{color:"#DDDDDD"},crosshair:{horizontal:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}},vertical:{line:{color:"#76808F"},text:{borderColor:"#686D76",backgroundColor:"#686D76"}}}},dark:{grid:{horizontal:{color:"#292929"},vertical:{color:"#292929"}},candle:{priceMark:{high:{color:"#929AA5"},low:{color:"#929AA5"}},tooltip:{rect:{color:"rgba(10, 10, 10, .6)",borderColor:"rgba(10, 10, 10, .6)"},text:{color:"#929AA5"}}},indicator:{tooltip:{text:{color:"#929AA5"}}},xAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},yAxis:{axisLine:{color:"#333333"},tickText:{color:"#929AA5"},tickLine:{color:"#333333"}},separator:{color:"#333333"},crosshair:{horizontal:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}},vertical:{line:{color:"#929AA5"},text:{borderColor:"#373a40",backgroundColor:"#373a40"}}}}};function Yt(t){var e;return null!==(e=zt[t])&&void 0!==e?e:null}class Xt{constructor(t,e){this._styles={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:m.Dashed,dashedValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:m.Dashed,dashedValue:[2,2]}},candle:{type:y.CandleSolid,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#1677FF",value:"close",backgroundColor:[{offset:0,color:"rgba(22, 119, 255, 0.01)"},{offset:1,color:"rgba(22, 119, 255, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textOffset:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:m.Dashed,dashedValue:[4,4],size:1},text:{show:!0,style:p.Fill,size:12,paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderStyle:m.Solid,borderSize:1,borderDashedValue:[2,2],color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:_.Always,showType:x.Standard,custom:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",color:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:10,marginTop:8,marginRight:6,marginBottom:0},icons:[]}},indicator:{ohlc:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},bars:[{style:p.Fill,borderStyle:m.Solid,borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lines:[{style:m.Solid,smooth:!1,size:1,dashedValue:[2,2],color:"#FF9600"},{style:m.Solid,smooth:!1,size:1,dashedValue:[2,2],color:"#9D65C9"},{style:m.Solid,smooth:!1,size:1,dashedValue:[2,2],color:"#1677FF"},{style:m.Solid,smooth:!1,size:1,dashedValue:[2,2],color:"#E11D74"},{style:m.Solid,smooth:!1,size:1,dashedValue:[2,2],color:"#01C5C4"}],circles:[{style:p.Fill,borderStyle:m.Solid,borderSize:1,borderDashedValue:[2,2],upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"}],lastValueMark:{show:!1,text:{show:!1,style:p.Fill,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:m.Solid,borderSize:1,borderDashedValue:[2,2],paddingLeft:4,paddingTop:4,paddingRight:4,paddingBottom:4,borderRadius:2}},tooltip:{showRule:_.Always,showType:x.Standard,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:10,marginTop:8,marginRight:6,marginBottom:0},icons:[]}},xAxis:{show:!0,size:"auto",axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,size:"auto",type:C.Normal,position:S.Right,inside:!1,reverse:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",marginStart:4,marginEnd:4},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:m.Dashed,dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:p.Fill,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:m.Solid,borderDashedValue:[2,2],borderSize:1,borderColor:"#686D76",borderRadius:2,paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:m.Dashed,dashedValue:[4,2],size:1,color:"#76808F"},text:{show:!0,style:p.Fill,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:m.Solid,borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#686D76",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#686D76"}}},overlay:{point:{color:"#1677FF",borderColor:"rgba(22, 119, 255, 0.35)",borderSize:1,radius:5,activeColor:"#1677FF",activeBorderColor:"rgba(22, 119, 255, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:m.Solid,smooth:!1,color:"#1677FF",size:1,dashedValue:[2,2]},rect:{style:p.Fill,color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderRadius:0,borderStyle:m.Solid,borderDashedValue:[2,2]},polygon:{style:p.Fill,color:"#1677FF",borderColor:"#1677FF",borderSize:1,borderStyle:m.Solid,borderDashedValue:[2,2]},circle:{style:p.Fill,color:"rgba(22, 119, 255, 0.25)",borderColor:"#1677FF",borderSize:1,borderStyle:m.Solid,borderDashedValue:[2,2]},arc:{style:m.Solid,color:"#1677FF",size:1,dashedValue:[2,2]},text:{color:"#1677FF",size:12,family:"Helvetica Neue",weight:"normal"},rectText:{style:p.Fill,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",borderStyle:m.Solid,borderDashedValue:[2,2],borderSize:1,borderRadius:2,borderColor:"#1677FF",paddingLeft:4,paddingRight:4,paddingTop:4,paddingBottom:4,backgroundColor:"#1677FF"}}},this._customApi={formatDate:u,formatBigNumber:v},this._locale="en-US",this._precision={price:2,volume:0},this._dataList=[],this._timeScaleStore=new W(this),this._indicatorStore=new ht(this),this._overlayStore=new Ot(this),this._crosshairStore=new dt(this),this._tooltipStore=new ut(this),this._actionStore=new Wt,this._visibleDataList=[],this._chart=t,this.setOptions(e)}adjustVisibleDataList(){this._visibleDataList=[];const{from:t,to:e}=this._timeScaleStore.getVisibleRange();for(let i=t;i<e;i++){const t=this._dataList[i],e=this._timeScaleStore.dataIndexToCoordinate(i);this._visibleDataList.push({dataIndex:i,x:e,data:t})}}setOptions(t){if(void 0!==t){const{locale:i,timezone:n,styles:o,customApi:s}=t;void 0!==i&&(this._locale=i),void 0!==n&&this._timeScaleStore.setTimezone(n),void 0!==o&&(l(o)?e(this._styles,Yt(o)):e(this._styles,o)),void 0!==s&&e(this._customApi,s)}return this}getStyles(){return this._styles}getLocale(){return this._locale}getCustomApi(){return this._customApi}getPrecision(){return this._precision}setPrecision(t){return this._precision=t,this._indicatorStore.setSeriesPrecision(t),this}getDataList(){return this._dataList}getVisibleDataList(){return this._visibleDataList}addData(t,e,i){if(n(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(null==i||i);const e=0===this._dataList.length;this._dataList=t.concat(this._dataList),e&&this._timeScaleStore.resetOffsetRightDistance(),this._timeScaleStore.adjustVisibleRange()}else if(e>=this._dataList.length){this._dataList.push(t);let e=this._timeScaleStore.getOffsetRightBarCount();e<0&&this._timeScaleStore.setOffsetRightBarCount(--e),this._timeScaleStore.adjustVisibleRange()}else this._dataList[e]=t,this.adjustVisibleDataList();this._crosshairStore.recalculate(!0)}clearDataList(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}getTimeScaleStore(){return this._timeScaleStore}getIndicatorStore(){return this._indicatorStore}getOverlayStore(){return this._overlayStore}getCrosshairStore(){return this._crosshairStore}getTooltipStore(){return this._tooltipStore}getActionStore(){return this._actionStore}getChart(){return this._chart}}function Ht(t){return null==window.requestAnimationFrame?window.setTimeout(t,20):window.requestAnimationFrame(t)}function $t(t){null==window.cancelAnimationFrame&&window.clearTimeout(t),window.cancelAnimationFrame(t)}const jt=-1;class Gt extends Rt{constructor(){super(...arguments),this._mainRequestAnimationId=jt,this._overlayRequestAnimationId=jt}getContainerStyle(){return{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden",boxSizing:"border-box"}}initDom(t){this._mainCanvas=D("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._mainCtx=this._mainCanvas.getContext("2d"),this._overlayCanvas=D("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2",boxSizing:"border-box"}),this._overlayCtx=this._overlayCanvas.getContext("2d"),t.appendChild(this._mainCanvas),t.appendChild(this._overlayCanvas)}_optimalUpdateMain(){this._mainRequestAnimationId!==jt&&($t(this._mainRequestAnimationId),this._mainRequestAnimationId=jt),this._mainRequestAnimationId=Ht((()=>{this.updateMain(this._mainCtx)}))}_optimalUpdateOverlay(){this._overlayRequestAnimationId!==jt&&($t(this._overlayRequestAnimationId),this._overlayRequestAnimationId=jt),this._overlayRequestAnimationId=Ht((()=>{this.updateOverlay(this._overlayCtx)}))}updateImp(t,e,i){const{width:n,height:o,left:s}=i;e.style.left=`${s}px`;let r=t;if(n!==e.offsetWidth||o!==e.offsetHeight){this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);const t=`${n}px`,i=`${o}px`;e.style.width=t,e.style.height=i;const s=P(this._mainCanvas),a=Math.floor(n*s),l=Math.floor(o*s);this._mainCanvas.style.width=t,this._mainCanvas.style.height=i,this._mainCanvas.width=a,this._mainCanvas.height=l,this._mainCtx.scale(s,s),this._overlayCanvas.style.width=t,this._overlayCanvas.style.height=i,this._overlayCanvas.width=a,this._overlayCanvas.height=l,this._overlayCtx.scale(s,s),r=3}else 4!==r&&3!==r&&0!==r||this._mainCtx.clearRect(0,0,this._mainCanvas.offsetWidth,this._mainCanvas.offsetHeight),4!==r&&3!==r&&1!==r||this._overlayCtx.clearRect(0,0,this._overlayCanvas.offsetWidth,this._overlayCanvas.offsetHeight);switch(r){case 0:this._optimalUpdateMain();break;case 1:this._optimalUpdateOverlay();break;case 3:case 4:this._optimalUpdateMain(),this._optimalUpdateOverlay()}}getImage(t){const{width:e,height:i}=this.getBounding(),n=D("canvas",{width:`${e}px`,height:`${i}px`,boxSizing:"border-box"}),o=n.getContext("2d"),s=P(n);return n.width=e*s,n.height=i*s,o.scale(s,s),o.drawImage(this._mainCanvas,0,0,e,i),t&&o.drawImage(this._overlayCanvas,0,0,e,i),n}}class Ut extends Pt{constructor(t){super(),this.attrs=t.attrs,this.styles=t.styles}checkEventOn(t){return this.checkEventOnImp(t,this.attrs,this.styles)}draw(t){this.drawImp(t,this.attrs,this.styles)}static extend(t){return class extends Ut{checkEventOnImp(e,i,n){return t.checkEventOn(e,i,n)}drawImp(e,i,n){t.draw(e,i,n)}}}}function Zt(t,e){const i=t.x-e.x,n=t.y-e.y,o=e.r;return!(i*i+n*n>o*o)}function qt(t,e,i){const{x:n,y:o,r:s}=e,{style:r=p.Fill,color:a="currentColor",borderSize:l=1,borderColor:c="currentColor",borderStyle:h=m.Solid,borderDashedValue:d=[2,2]}=i;r!==p.Fill&&i.style!==p.StrokeFill||(t.fillStyle=a,t.beginPath(),t.arc(n,o,s,0,2*Math.PI),t.closePath(),t.fill()),r!==p.Stroke&&i.style!==p.StrokeFill||(t.strokeStyle=c,t.lineWidth=l,h===m.Dashed?t.setLineDash(d):t.setLineDash([]),t.beginPath(),t.arc(n,o,s,0,2*Math.PI),t.closePath(),t.stroke())}const Kt={name:"circle",checkEventOn:Zt,draw:(t,e,i)=>{qt(t,e,i)}};function Jt(t,e){let i=!1;const n=e.coordinates;for(let o=0,s=n.length-1;o<n.length;s=o++)n[o].y>t.y!=n[s].y>t.y&&t.x<(n[s].x-n[o].x)*(t.y-n[o].y)/(n[s].y-n[o].y)+n[o].x&&(i=!i);return i}function Qt(t,e,i){const{coordinates:n}=e,{style:o=p.Fill,color:s="currentColor",borderSize:r=1,borderColor:a="currentColor",borderStyle:l=m.Solid,borderDashedValue:c=[2,2]}=i;if(o===p.Fill||i.style===p.StrokeFill){t.fillStyle=s,t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.fill()}if(o===p.Stroke||i.style===p.StrokeFill){t.strokeStyle=a,t.lineWidth=r,l===m.Dashed?t.setLineDash(c):t.setLineDash([]),t.beginPath(),t.moveTo(n[0].x,n[0].y);for(let e=1;e<n.length;e++)t.lineTo(n[e].x,n[e].y);t.closePath(),t.stroke()}}const te={name:"polygon",checkEventOn:Jt,draw:(t,e,i)=>{Qt(t,e,i)}};function ee(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}function ie(t,e,i){const{x:n,y:o,width:s,height:r}=e,{style:a=p.Fill,color:l="currentColor",borderSize:c=1,borderColor:h="currentColor",borderStyle:d=m.Solid,borderRadius:u=0,borderDashedValue:g=[2,2]}=i;a!==p.Fill&&i.style!==p.StrokeFill||(t.fillStyle=l,t.beginPath(),t.moveTo(n+u,o),t.arcTo(n+s,o,n+s,o+r,u),t.arcTo(n+s,o+r,n,o+r,u),t.arcTo(n,o+r,n,o,u),t.arcTo(n,o,n+s,o,u),t.closePath(),t.fill()),a!==p.Stroke&&i.style!==p.StrokeFill||(t.strokeStyle=h,t.lineWidth=c,d===m.Dashed?t.setLineDash(g):t.setLineDash([]),t.beginPath(),t.moveTo(n+u,o),t.arcTo(n+s,o,n+s,o+r,u),t.arcTo(n+s,o+r,n,o+r,u),t.arcTo(n,o+r,n,o,u),t.arcTo(n,o,n+s,o,u),t.closePath(),t.stroke())}const ne={name:"rect",checkEventOn:ee,draw:(t,e,i)=>{ie(t,e,i)}};function oe(t,e,i){const{size:n=12,paddingLeft:o=0,paddingTop:s=0,paddingRight:r=0,paddingBottom:a=0}=e,{x:l,y:c,text:h,align:d="left",baseline:u="top"}=t,g=h.length;i=null!=i?i:n*g;const v=n;let m,p;switch(d){case"left":case"start":m=l;break;case"right":case"end":m=l-r-i-o;break;default:m=l-i/2-o}switch(u){case"top":case"hanging":p=c;break;case"bottom":case"ideographic":case"alphabetic":p=c-v-s-a;break;default:p=c-v/2-s}return{x:m,y:p,width:o+i+r,height:s+v+a}}function se(t,e,i){const{x:n,y:o,width:s,height:r}=oe(e,i);return t.x>=n&&t.x<=n+s&&t.y>=o&&t.y<=o+r}function re(t,e,i){const{x:n,y:o,text:s,align:r="left",baseline:a="top"}=e,{color:l="currentColor",size:c=12,family:h,weight:d}=i;t.textAlign=r,t.textBaseline=a,t.font=k(c,d,h),t.fillStyle=l,t.fillText(s,n,o)}const ae={name:"text",checkEventOn:(t,e,i)=>se(t,e,i),draw:(t,e,i)=>{re(t,e,i)}};function le(t,e,i){const{text:n}=e,{size:o=12,family:s,weight:r,paddingLeft:a=0,paddingTop:l=0}=i;t.font=k(o,r,s);const c=oe(e,i,t.measureText(n).width);ie(t,c,{...i,color:i.backgroundColor}),re(t,{x:c.x+a,y:c.y+l,text:n,align:"left",baseline:"top"},i)}const ce={name:"rectText",checkEventOn:(t,e,i)=>se(t,e,i),draw:(t,e,i)=>{le(t,e,i)}},he={};[Kt,Ct,te,ne,ae,ce].forEach((t=>{he[t.name]=Ut.extend(t)}));class de extends Pt{constructor(t){super(),this._widget=t}getWidget(){return this._widget}createFigure(t,e,i,n){const o=function(t){var e;return null!==(e=he[t])&&void 0!==e?e:null}(t);if(null!==o){const s=new o({name:t,attrs:e,styles:i});if(void 0!==n){for(const t in n)n.hasOwnProperty(t)&&s.registerEvent(t,n[t]);this.addChild(s)}return s}return null}draw(t){this.clear(),this.drawImp(t)}}class ue extends de{drawImp(t){var e;const i=this.getWidget(),n=this.getWidget().getPane(),o=n.getChart(),s=i.getBounding(),r=o.getStyles().grid;if(r.show){t.save(),t.globalCompositeOperation="destination-over";const i=r.horizontal;i.show&&n.getAxisComponent().getTicks().forEach((e=>{var n;null===(n=this.createFigure("line",{coordinates:[{x:0,y:e.coord},{x:s.width,y:e.coord}]},i))||void 0===n||n.draw(t)}));const a=r.vertical;a.show&&(null===(e=o.getPaneById(Nt.XAXIS))||void 0===e?void 0:e.getAxisComponent()).getTicks().forEach((e=>{var i;null===(i=this.createFigure("line",{coordinates:[{x:e.coord,y:0},{x:e.coord,y:s.height}]},a))||void 0===i||i.draw(t)})),t.restore()}}}class ge extends de{eachChildren(t){const e=this.getWidget().getPane().getChart().getChartStore(),i=e.getVisibleDataList(),n=e.getTimeScaleStore().getBarSpace();i.forEach(((e,i)=>{t(e,n,i)}))}}class ve extends ge{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=this.getCandleBarOptions(i);if(null!==n){const i=e.getAxisComponent();this.eachChildren(((e,o)=>{this._drawCandleBar(t,i,e,o,n)}))}}getCandleBarOptions(t){const e=t.getStyles().candle;return{type:e.type,styles:e.bar}}_drawCandleBar(t,e,i,n,o){const{data:s,x:r}=i,{open:a,high:l,low:c,close:h}=s,{halfGapBar:d,gapBar:u}=n,{type:g,styles:v}=o;let m;m=h>a?v.upColor:h<a?v.downColor:v.noChangeColor;const _=e.convertToPixel(a),x=e.convertToPixel(h),f=[_,x,e.convertToPixel(l),e.convertToPixel(c)];f.sort(((t,e)=>t-e));const S=Math.max(1,f[2]-f[1]);let C=[];g!==y.Ohlc?(C.push({name:"rect",attrs:{x:r-.5,y:f[0],width:1,height:f[1]-f[0]},styles:{color:m}}),g===y.CandleStroke||g===y.CandleUpStroke&&a<h||g===y.CandleDownStroke&&a>h?C.push({name:"rect",attrs:{x:r-d+.5,y:f[1],width:u-1,height:S},styles:{style:p.Stroke,borderColor:m}}):C.push({name:"rect",attrs:{x:r-d,y:f[1],width:u,height:S},styles:{color:m}}),C.push({name:"rect",attrs:{x:r-.5,y:f[2],width:1,height:f[3]-f[2]},styles:{color:m}})):C=[{name:"rect",attrs:{x:r-.5,y:f[0],width:1,height:f[3]-f[0]},styles:{color:m}},{name:"rect",attrs:{x:r-d,y:_,width:d,height:1},styles:{color:m}},{name:"rect",attrs:{x:r,y:x,width:d,height:1},styles:{color:m}}],C.forEach((({attrs:e,styles:i})=>{var n;null===(n=this.createFigure("rect",e,i))||void 0===n||n.draw(t)}))}}class me extends ve{getCandleBarOptions(t){const e=this.getWidget().getPane();if(!e.getAxisComponent().isInCandle()){const i=t.getIndicatorStore().getInstances(e.getId());for(const e of i){const i=e[1];if(i.shouldOhlc&&i.visible){const e=i.styles,n=t.getStyles().indicator;return{type:y.Ohlc,styles:{upColor:d(e,"ohlc.upColor",n.ohlc.upColor),downColor:d(e,"ohlc.downColor",n.ohlc.downColor),noChangeColor:d(e,"ohlc.noChangeColor",n.ohlc.noChangeColor)}}}}}return null}drawImp(t){var e;super.drawImp(t);const i=this.getWidget(),n=i.getPane(),o=n.getChart(),s=i.getBounding(),r=null===(e=o.getPaneById(Nt.XAXIS))||void 0===e?void 0:e.getAxisComponent(),l=n.getAxisComponent(),c=o.getChartStore(),h=c.getDataList(),d=c.getTimeScaleStore(),u=d.getVisibleRange(),g=c.getIndicatorStore().getInstances(n.getId()),v=c.getStyles().indicator;g.forEach((e=>{var i;if(e.visible){let n=!1;if(null!==e.draw&&(t.save(),n=null!==(i=e.draw({ctx:t,kLineDataList:h,indicator:e,visibleRange:u,bounding:s,barSpace:d.getBarSpace(),defaultStyles:v,xAxis:r,yAxis:l}))&&void 0!==i&&i,t.restore()),!n){const i=e.result,n=[],o=[],s=[];this.eachChildren(((r,c)=>{var d;const{halfGapBar:g,gapBar:m}=c,{dataIndex:p,x:_}=r,x=null!==(d=i[p])&&void 0!==d?d:{};Y(h,e,p,v,((e,i,r,c)=>{var h,d,v;const f=x[e.key],y=l.convertToPixel(f);switch(e.type){case"circle":a(f)&&(null===(h=this.createFigure("circle",{x:_,y:y,r:g},{style:i.style,color:i.color,borderColor:i.color}))||void 0===h||h.draw(t));break;case"bar":if(a(f)){const n=null!==(d=e.baseValue)&&void 0!==d?d:l.getExtremum().min,o=l.convertToPixel(n);let s,r=Math.abs(o-y);n!==f&&(r=Math.max(1,r)),s=y>o?o:y,null===(v=this.createFigure("rect",{x:_-g,y:s,width:m,height:r},{style:i.style,color:i.color,borderColor:i.color}))||void 0===v||v.draw(t)}break;case"line":{let t=null;if(a(f)){t=i;const e={x:_,y:y},l=n[c];a(o[c])||(o[c]=[]),o[c].push(e),a(l)&&((null==l?void 0:l.color)!==i.color||(null==l?void 0:l.style)!==i.style)&&(s.push({name:"line",attrs:{coordinates:o[c]},styles:{style:i.style,color:i.color,size:r.size,smooth:r.smooth,dashedValue:r.dashedValue}}),o[c]=[e]),p===u.to-1&&s.push({name:"line",attrs:{coordinates:o[c]},styles:{style:i.style,color:null==i?void 0:i.color,size:r.size,smooth:r.smooth,dashedValue:r.dashedValue}})}n[c]=t;break}}}))})),s.forEach((({attrs:e,styles:i})=>{var n;null===(n=this.createFigure("line",e,i))||void 0===n||n.draw(t)}))}}}))}}class pe extends de{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=e.getBounding(),o=e.getPane().getChart().getChartStore(),s=o.getCrosshairStore().get(),r=o.getStyles().crosshair;if(void 0!==s.paneId&&r.show){if(s.paneId===i.getId()){const e=s.y;this._drawLine(t,[{x:0,y:e},{x:n.width,y:e}],r.horizontal)}const e=s.realX;this._drawLine(t,[{x:e,y:0},{x:e,y:n.height}],r.vertical)}}_drawLine(t,e,i){var n;if(i.show){const o=i.line;o.show&&(null===(n=this.createFigure("line",{coordinates:e},o))||void 0===n||n.draw(t))}}}class _e extends de{constructor(){super(...arguments),this._boundIconClickEvent=(t,e)=>i=>(this.getWidget().getPane().getChart().getChartStore().getActionStore().execute(w.OnTooltipIconClick,{...t,iconId:e}),!0),this._boundIconMouseMoveEvent=(t,e)=>i=>(this.getWidget().getPane().getChart().getChartStore().getTooltipStore().setActiveIconInfo({...t,iconId:e}),!0)}drawImp(t){const e=this.getWidget(),i=e.getPane(),n=i.getChart().getChartStore(),o=n.getCrosshairStore().get();if(void 0!==o.kLineData){const s=e.getBounding(),r=n.getCustomApi(),a=n.getIndicatorStore().getInstances(i.getId()),l=n.getTooltipStore().getActiveIconInfo(),c=n.getStyles().indicator;this.drawIndicatorTooltip(t,i.getId(),n.getDataList(),o,l,a,r,s,c)}}drawIndicatorTooltip(t,e,i,n,o,s,r,a,l,c){const h=l.tooltip;let d=0;if(this.isDrawTooltip(n,h)){const u=h.text;let g=0,v=null!=c?c:0,m=0;s.forEach((s=>{const{name:c,calcParamsText:h,values:p,icons:_}=this.getIndicatorTooltipData(i,n,s,r,l),x=c.length>0,f=p.length>0;if(x||f){const[i,n,r]=this.classifyTooltipIcons(_),[l,y,S,C]=this.drawStandardTooltipIcons(t,a,{paneId:e,indicatorName:s.name,iconId:""},o,i,g,v,m);if(g=l,v=y,d+=C,m=S,x){let e=c;h.length>0&&(e=`${e}${h}`);const[i,n,o,s]=this.drawStandardTooltipLabels(t,a,[{title:{text:"",color:u.color},value:{text:e,color:u.color}}],g,v,m,u);g=i,v=n,d+=s,m=o}const[b,w,I,E]=this.drawStandardTooltipIcons(t,a,{paneId:e,indicatorName:s.name,iconId:""},o,n,g,v,m);if(g=b,v=w,d+=E,m=I,f){const[e,i,n,o]=this.drawStandardTooltipLabels(t,a,p,g,v,m,u);g=e,v=i,d+=o,m=n}const[T,D,M,P]=this.drawStandardTooltipIcons(t,a,{paneId:e,indicatorName:s.name,iconId:""},o,r,g,v,m);g=T,v=D,d+=P,m=M}}))}return d}drawStandardTooltipIcons(t,e,i,n,o,s,r,a){let l=s,c=r,h=0,d=0,u=0;return o.length>0&&(o.forEach((e=>{const{marginLeft:i,marginTop:n,marginRight:o,marginBottom:s,paddingLeft:r,paddingTop:a,paddingRight:l,paddingBottom:c,size:u,fontFamily:g,icon:v}=e;t.font=k(u,"normal",g),h+=i+r+t.measureText(v).width+l+o,d=Math.max(d,n+a+u+c+s)})),l+h>e.width?(l=o[0].marginLeft,c+=a,u=d):u=Math.max(0,d-a),o.forEach((e=>{var o;const{marginLeft:s,marginTop:r,marginRight:a,paddingLeft:h,paddingTop:d,paddingRight:u,paddingBottom:g,color:v,activeColor:m,size:p,fontFamily:_,icon:x,backgroundColor:f,activeBackgroundColor:y}=e;l+=s;const S=n.paneId===i.paneId&&n.indicatorName===i.indicatorName&&n.iconId===e.id;null===(o=this.createFigure("rectText",{text:x,x:l,y:c+r},{paddingLeft:h,paddingTop:d,paddingRight:u,paddingBottom:g,color:S?m:v,size:p,family:_,backgroundColor:S?y:f},{mouseDownEvent:this._boundIconClickEvent(i,e.id),mouseMoveEvent:this._boundIconMouseMoveEvent(i,e.id)}))||void 0===o||o.draw(t),l+=h+t.measureText(x).width+u+a}))),[l,c,Math.max(a,d),u]}drawStandardTooltipLabels(t,e,i,n,o,s,r){let a=n,l=o,c=0,h=0,d=s;if(i.length>0){const{marginLeft:n,marginTop:o,marginRight:s,marginBottom:u,size:g,family:v,weight:m}=r;t.font=k(g,m,v),i.forEach((i=>{var r,p;const _=i.title,x=i.value,f=t.measureText(_.text).width,y=t.measureText(x.text).width,S=g+o+u;a+n+(f+y)+s>e.width?(a=n,l+=S,h+=S):(a+=n,h+=Math.max(0,S-d)),c=Math.max(d,S),d=c,_.text.length>0&&(null===(r=this.createFigure("text",{x:a,y:l+o,text:_.text},{color:_.color,size:g,family:v,weight:m}))||void 0===r||r.draw(t),a+=f),null===(p=this.createFigure("text",{x:a,y:l+o,text:x.text},{color:x.color,size:g,family:v,weight:m}))||void 0===p||p.draw(t),a+=y+s}))}return[a,l,c,h]}isDrawTooltip(t,e){const i=e.showRule;return i===_.Always||i===_.FollowCross&&void 0!==t.paneId}getIndicatorTooltipData(t,e,i,n,o){var r,l,c;const h=o.tooltip,d=h.showName?i.shortName:"";let u="";const v=i.calcParams;v.length>0&&h.showParams&&(u=`(${v.join(",")})`);const m={name:d,calcParamsText:u,values:[],icons:h.icons},p=e.dataIndex,_=null!==(r=i.result)&&void 0!==r?r:[],x=[];if(i.visible){const e=null!==(l=_[p])&&void 0!==l?l:{};Y(t,i,p,o,((t,o)=>{if(void 0!==t.title){const s=o.color;let r=e[t.key];a(r)&&(r=g(r,i.precision),i.shouldFormatBigNumber&&(r=n.formatBigNumber(r))),x.push({title:{text:t.title,color:s},value:{text:null!=r?r:h.defaultValue,color:s}})}})),m.values=x}if(null!==i.createTooltipDataSource){const n=this.getWidget(),r=n.getPane(),a=r.getChart().getChartStore(),{name:l,calcParamsText:d,values:u,icons:g}=i.createTooltipDataSource({kLineDataList:t,indicator:i,visibleRange:a.getTimeScaleStore().getVisibleRange(),bounding:n.getBounding(),crosshair:e,defaultStyles:o,xAxis:null===(c=r.getChart().getPaneById(Nt.XAXIS))||void 0===c?void 0:c.getAxisComponent(),yAxis:r.getAxisComponent()});if(void 0!==l&&h.showName&&(m.name=l),void 0!==d&&h.showParams&&(m.calcParamsText=d),void 0!==g&&(m.icons=g),void 0!==u&&i.visible){const t=[],e=o.tooltip.text.color;u.forEach((i=>{let n={text:"",color:e};s(i.title)?n=i.title:n.text=i.title;let o={text:"",color:e};s(i.value)?o=i.value:o.text=i.value,t.push({title:n,value:o})})),m.values=t}}return m}classifyTooltipIcons(t){const e=[],i=[],n=[];return t.forEach((t=>{switch(t.position){case f.Left:e.push(t);break;case f.Middle:i.push(t);break;case f.Right:n.push(t)}})),[e,i,n]}}class xe extends de{constructor(t){super(t),this._initEvent()}_initEvent(){const t=this.getWidget().getPane(),e=t.getId(),i=t.getChart().getChartStore().getOverlayStore();this.registerEvent("mouseMoveEvent",(t=>{var n;const o=i.getProgressInstanceInfo();if(null!==o){const s=o.instance;let r=o.paneId;return s.isStart()&&(i.updateProgressInstanceInfo(e),r=e),s.isDrawing()&&r===e&&(s.eventMoveForDrawing(this._coordinateToPoint(o.instance,t)),null===(n=s.onDrawing)||void 0===n||n.call(s,{overlay:s,...t})),this._figureMouseMoveEvent(o.instance,1,o.instance.points.length-1,0)(t)}return i.setHoverInstanceInfo({paneId:e,instance:null,figureType:0,figureIndex:-1,attrsIndex:-1},t),!1})).registerEvent("mouseDownEvent",(t=>{var n,o;const s=i.getProgressInstanceInfo();if(null!==s){const r=s.instance;let a=s.paneId;return r.isStart()&&(i.updateProgressInstanceInfo(e,!0),a=e),r.isDrawing()&&a===e&&(r.eventMoveForDrawing(this._coordinateToPoint(r,t)),null===(n=r.onDrawing)||void 0===n||n.call(r,{overlay:r,...t}),r.nextStep(),r.isDrawing()||(i.progressInstanceComplete(),null===(o=r.onDrawEnd)||void 0===o||o.call(r,{overlay:r,...t}))),this._figureMouseDownEvent(r,1,r.points.length-1,0)(t)}return i.setClickInstanceInfo({paneId:e,instance:null,figureType:0,figureIndex:-1,attrsIndex:-1},t),!1})).registerEvent("mouseRightClickEvent",(t=>{const e=i.getProgressInstanceInfo();if(null!==e){const i=e.instance;if(i.isDrawing())return this._figureMouseRightClickEvent(i,1,i.points.length-1,0)(t)}return!1})).registerEvent("mouseUpEvent",(t=>{var n;const{instance:o}=i.getPressedInstanceInfo();return null!==o&&(null===(n=o.onPressedMoveEnd)||void 0===n||n.call(o,{overlay:o,...t})),i.setPressedInstanceInfo({paneId:e,instance:null,figureType:0,figureIndex:-1,attrsIndex:-1}),!1})).registerEvent("pressedMouseMoveEvent",(t=>{var e,n;const{instance:o,figureType:s,figureIndex:r}=i.getPressedInstanceInfo();if(null!==o){if(!(o.lock||null!==(n=null===(e=o.onPressedMoving)||void 0===e?void 0:e.call(o,{overlay:o,...t}))&&void 0!==n&&n)){const e=this._coordinateToPoint(o,t);1===s?o.eventPressedPointMove(e,r):o.eventPressedOtherMove(e,this.getWidget().getPane().getChart().getChartStore().getTimeScaleStore())}return!0}return!1}))}_createFigureEvents(t,e,i,n){if(!t.isDrawing())return{mouseMoveEvent:this._figureMouseMoveEvent(t,e,i,n),mouseDownEvent:this._figureMouseDownEvent(t,e,i,n),mouseRightClickEvent:this._figureMouseRightClickEvent(t,e,i,n)}}_figureMouseMoveEvent(t,e,i,n){return o=>{const s=this.getWidget().getPane();return s.getChart().getChartStore().getOverlayStore().setHoverInstanceInfo({paneId:s.getId(),instance:t,figureType:e,figureIndex:i,attrsIndex:n},o),!0}}_figureMouseDownEvent(t,e,i,n){return o=>{var s;const r=this.getWidget().getPane(),a=r.getId(),l=r.getChart().getChartStore().getOverlayStore();return t.startPressedMove(this._coordinateToPoint(t,o)),null===(s=t.onPressedMoveStart)||void 0===s||s.call(t,{overlay:t,...o}),l.setPressedInstanceInfo({paneId:a,instance:t,figureType:e,figureIndex:i,attrsIndex:n}),l.setClickInstanceInfo({paneId:a,instance:t,figureType:e,figureIndex:i,attrsIndex:n},o),!0}}_figureMouseRightClickEvent(t,e,i,n){return e=>{var i,n;return null!==(n=null===(i=t.onRightClick)||void 0===i?void 0:i.call(t,{overlay:t,...e}))&&void 0!==n&&n||this.getWidget().getPane().getChart().getChartStore().getOverlayStore().removeInstance(t),!0}}_coordinateToPoint(t,e){var i,n;const o={},s=this.getWidget().getPane(),r=s.getChart(),a=s.getId(),l=r.getChartStore().getTimeScaleStore();if(this.coordinateToPointTimestampDataIndexFlag()){const t=(null===(i=r.getPaneById(Nt.XAXIS))||void 0===i?void 0:i.getAxisComponent()).convertFromPixel(e.x),s=null!==(n=l.dataIndexToTimestamp(t))&&void 0!==n?n:void 0;o.dataIndex=t,o.timestamp=s}if(this.coordinateToPointValueFlag()){const i=s.getAxisComponent();let n=i.convertFromPixel(e.y);if(t.mode!==gt.Normal&&a===Nt.CANDLE&&void 0!==o.dataIndex){const e=l.getDataByDataIndex(o.dataIndex);if(null!==e)if(n>e.high)if(t.mode===gt.WeakMagnet){const t=i.convertToPixel(e.high);n<i.convertFromPixel(t-8)&&(n=e.high)}else n=e.high;else if(n<e.low)if(t.mode===gt.WeakMagnet){const t=i.convertToPixel(e.low);n>i.convertFromPixel(t-8)&&(n=e.low)}else n=e.low;else{const t=Math.max(e.open,e.close),i=Math.min(e.open,e.close);n=n>t?n-t<e.high-n?t:e.high:n<i?n-e.low<i-n?e.low:i:t-n<n-i?t:i}}o.value=n}return o}coordinateToPointValueFlag(){return!0}coordinateToPointTimestampDataIndexFlag(){return!0}dispatchEvent(t,e,i){return this.getWidget().getPane().getChart().getChartStore().getOverlayStore().isDrawing()?this.onEvent(t,e,i):super.dispatchEvent(t,e,i)}checkEventOn(t){return!0}drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),o=n.getId(),s=n.getChart(),r=n.getAxisComponent(),a=null===(e=s.getPaneById(Nt.XAXIS))||void 0===e?void 0:e.getAxisComponent(),l=i.getBounding(),c=s.getChartStore(),h=c.getCustomApi(),d=c.getTimeScaleStore(),u=d.getDateTimeFormat(),g=d.getBarSpace(),v=c.getPrecision(),m=c.getStyles().overlay,p=c.getOverlayStore(),_=p.getHoverInstanceInfo(),x=p.getClickInstanceInfo();this.getCompleteOverlays(p,o).forEach((e=>{e.visible&&this._drawOverlay(t,e,l,g,v,u,h,m,a,r,_,x,d)}));const f=p.getProgressInstanceInfo();if(null!==f){const e=this.getProgressOverlay(f,o);null!==e&&e.visible&&this._drawOverlay(t,e,l,g,v,u,h,m,a,r,_,x,d)}}_drawOverlay(t,e,i,n,o,s,r,a,l,c,h,d,u){const{points:g}=e,v=g.map((t=>{var e,i;let n=t.dataIndex;void 0!==t.timestamp&&(n=u.timestampToDataIndex(t.timestamp));const o={x:0,y:0};return void 0!==n&&(o.x=null!==(e=null==l?void 0:l.convertToPixel(n))&&void 0!==e?e:0),void 0!==t.value&&(o.y=null!==(i=null==c?void 0:c.convertToPixel(t.value))&&void 0!==i?i:0),o}));if(v.length>0){const r=(new Array).concat(this.getFigures(e,v,i,n,o,s,a,l,c));this.drawFigures(t,e,r,a)}this.drawDefaultFigures(t,e,v,i,o,s,r,a,l,c,h,d)}drawFigures(t,e,i,n){i.forEach(((i,o)=>{const{type:s,styles:r,attrs:a,ignoreEvent:l}=i;[].concat(a).forEach(((i,a)=>{var c,h;const d=null!=l&&l?void 0:this._createFigureEvents(e,2,o,a),u={...n[s],...null===(c=e.styles)||void 0===c?void 0:c[s],...r};null===(h=this.createFigure(s,i,u,d))||void 0===h||h.draw(t)}))}))}getCompleteOverlays(t,e){return t.getInstances(e)}getProgressOverlay(t,e){return t.paneId===e?t.instance:null}getFigures(t,e,i,n,o,s,r,a,l){var c,h;return null!==(h=null===(c=t.createPointFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:o,dateTimeFormat:s,defaultStyles:r,xAxis:a,yAxis:l}))&&void 0!==h?h:[]}drawDefaultFigures(t,e,i,n,o,s,r,a,l,c,h,d){var u,g;if(e.needDefaultPointFigure&&((null===(u=h.instance)||void 0===u?void 0:u.id)===e.id&&0!==h.figureType||(null===(g=d.instance)||void 0===g?void 0:g.id)===e.id&&0!==d.figureType)){const n=e.styles,o={...a.point,...null==n?void 0:n.point};i.forEach((({x:i,y:n},s)=>{var r,a,l;let c=o.radius,d=o.color,u=o.borderColor,g=o.borderSize;(null===(r=h.instance)||void 0===r?void 0:r.id)===e.id&&1===h.figureType&&h.figureIndex===s&&(c=o.activeRadius,d=o.activeColor,u=o.activeBorderColor,g=o.activeBorderSize),null===(a=this.createFigure("circle",{x:i,y:n,r:c+g},{color:u},this._createFigureEvents(e,1,s,0)))||void 0===a||a.draw(t),null===(l=this.createFigure("circle",{x:i,y:n,r:c},{color:d}))||void 0===l||l.draw(t)}))}}}class fe extends Gt{constructor(t,e){super(t,e),this._gridView=new ue(this),this._indicatorView=new me(this),this._crosshairLineView=new pe(this),this._tooltipView=this.createTooltipView(),this._overlayView=new xe(this),this.addChild(this._overlayView),this.addChild(this._tooltipView),this.getContainer().style.cursor="crosshair",this.registerEvent("mouseMoveEvent",(()=>(e.getChart().getChartStore().getTooltipStore().setActiveIconInfo(),!1)))}getName(){return kt}updateMain(t){this.updateMainContent(t),this._indicatorView.draw(t),this._gridView.draw(t)}createTooltipView(){return new _e(this)}updateMainContent(t){}updateOverlay(t){this._overlayView.draw(t),this._crosshairLineView.draw(t),this._tooltipView.draw(t)}}class ye extends ge{drawImp(t){var e,i;const o=this.getWidget(),s=o.getPane(),a=s.getChart(),l=s.getChart().getChartStore(),c=o.getBounding(),h=s.getAxisComponent(),d=l.getTimeScaleStore().getBarSpace(),u=a.getStyles().candle.area,g=[],v=[];let m=Number.MAX_SAFE_INTEGER;this.eachChildren(((t,e,i)=>{const{data:n,x:o}=t,{halfGapBar:s}=e,a=n[u.value];if(r(a)){const t=h.convertToPixel(a);if(0===i){const e=o-s;v.push({x:e,y:c.height}),v.push({x:e,y:t}),g.push({x:e,y:t})}g.push({x:o,y:t}),v.push({x:o,y:t}),m=Math.min(m,t)}}));const p=v.length;if(p>0){const t=v[p-1],e=t.x+d.halfGapBar;g.push({x:e,y:t.y}),v.push({x:e,y:t.y}),v.push({x:e,y:c.height})}if(g.length>0&&(null===(e=this.createFigure("line",{coordinates:g},{color:u.lineColor,size:u.lineSize}))||void 0===e||e.draw(t)),v.length>0){const e=u.backgroundColor;let o;if(n(e)){const i=t.createLinearGradient(0,c.height,0,m);try{e.forEach((({offset:t,color:e})=>{i.addColorStop(t,e)}))}catch(t){}o=i}else o=e;null===(i=this.createFigure("polygon",{coordinates:v},{color:o}))||void 0===i||i.draw(t)}}}class Se extends ge{drawImp(t){const e=this.getWidget().getPane(),i=e.getChart().getChartStore(),n=i.getStyles().candle.priceMark,o=n.high,s=n.low;if(n.show&&(o.show||s.show)){const n=i.getPrecision(),r=e.getAxisComponent();let a=Number.MIN_SAFE_INTEGER,l=0,c=Number.MAX_SAFE_INTEGER,h=0;this.eachChildren(((t,e,i)=>{const{data:n,x:o}=t;a<n.high&&(a=n.high,l=o),c>n.low&&(c=n.low,h=o)}));const d=r.convertToPixel(a),u=r.convertToPixel(c);o.show&&a!==Number.MIN_SAFE_INTEGER&&this._drawMark(t,g(a,n.price),{x:l,y:d},d<u?[-2,-5]:[2,5],o),s.show&&c!==Number.MAX_SAFE_INTEGER&&this._drawMark(t,g(c,n.price),{x:h,y:u},d<u?[2,5]:[-2,-5],s)}}_drawMark(t,e,i,n,o){var s,r,a;const l=i.x,c=i.y+n[0];let h,d,u;null===(s=this.createFigure("line",{coordinates:[{x:l-2,y:c+n[0]},{x:l,y:c},{x:l+2,y:c+n[0]}]},{color:o.color}))||void 0===s||s.draw(t);const{width:g}=this.getWidget().getBounding();l>g/2?(h=l-5,d=h-o.textOffset,u="right"):(h=l+5,u="left",d=h+o.textOffset);const v=c+n[1];null===(r=this.createFigure("line",{coordinates:[{x:l,y:c},{x:l,y:v},{x:h,y:v}]},{color:o.color}))||void 0===r||r.draw(t),null===(a=this.createFigure("text",{x:d,y:v,text:e,align:u,baseline:"middle"},{color:o.color,size:o.textSize,family:o.textFamily,weight:o.textWeight}))||void 0===a||a.draw(t)}}class Ce extends de{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),o=i.getBounding(),s=n.getChart().getChartStore(),r=s.getStyles().candle.priceMark,a=r.last,l=a.line;if(r.show&&a.show&&l.show){const i=n.getAxisComponent(),r=s.getDataList(),c=r[r.length-1];if(null!=c){const{close:n,open:s}=c,r=i.convertToNicePixel(n);let h;h=n>s?a.upColor:n<s?a.downColor:a.noChangeColor,null===(e=this.createFigure("line",{coordinates:[{x:0,y:r},{x:o.width,y:r}]},{style:l.style,color:h,size:l.size,dashedValue:l.dashedValue}))||void 0===e||e.draw(t)}}}}const be={"zh-CN":{time:"\u65f6\u95f4\uff1a",open:"\u5f00\uff1a",high:"\u9ad8\uff1a",low:"\u4f4e\uff1a",close:"\u6536\uff1a",volume:"\u6210\u4ea4\u91cf\uff1a"},"en-US":{time:"Time: ",open:"Open: ",high:"High: ",low:"Low: ",close:"Close: ",volume:"Volume: "}};function we(t,e){var i,n;return null!==(n=null===(i=be[e])||void 0===i?void 0:i[t])&&void 0!==n?n:t}class Ie extends _e{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),o=n.getId(),s=n.getChart().getChartStore(),r=s.getCrosshairStore().get();if(void 0!==r.kLineData){const a=i.getBounding(),l=null===(e=n.getYAxisWidget())||void 0===e?void 0:e.getBounding(),c=s.getDataList(),h=s.getPrecision(),d=s.getLocale(),u=s.getCustomApi(),g=s.getTooltipStore().getActiveIconInfo(),v=s.getIndicatorStore().getInstances(n.getId()),m=s.getTimeScaleStore().getDateTimeFormat(),p=s.getStyles(),_=p.candle,f=p.indicator;if(_.tooltip.showType===x.Rect&&f.tooltip.showType===x.Rect){const e=this.isDrawTooltip(r,_.tooltip),i=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,c,v,a,l,r,h,m,d,u,e,i,p,0)}else if(_.tooltip.showType===x.Standard&&f.tooltip.showType===x.Standard){const e=this._drawCandleStandardTooltip(t,o,a,r,g,h,m,d,u,_);this.drawIndicatorTooltip(t,o,c,r,g,v,u,a,f,e)}else if(_.tooltip.showType===x.Rect&&f.tooltip.showType===x.Standard){const e=this.drawIndicatorTooltip(t,o,c,r,g,v,u,a,f,0),i=this.isDrawTooltip(r,_.tooltip);this._drawRectTooltip(t,c,v,a,l,r,h,m,d,u,i,!1,p,e)}else{const e=this._drawCandleStandardTooltip(t,o,a,r,g,h,m,d,u,_),i=this.isDrawTooltip(r,f.tooltip);this._drawRectTooltip(t,c,v,a,l,r,h,m,d,u,!1,i,p,e)}}}_drawCandleStandardTooltip(t,e,i,n,o,s,r,a,l,c){const h=c.tooltip,d=h.text;let u=0;if(this.isDrawTooltip(n,h)){const g=this._getCandleTooltipData(n.kLineData,s,r,a,l,c);let v=0,m=0,p=0;const[_,x,f]=this.classifyTooltipIcons(h.icons),[y,S,C,b]=this.drawStandardTooltipIcons(t,i,{paneId:e,indicatorName:"",iconId:""},o,_,v,m,0);v=y,m=S,u+=b,p=C;const[w,I,E,T]=this.drawStandardTooltipIcons(t,i,{paneId:e,indicatorName:"",iconId:""},o,x,v,m,p);if(v=w,m=I,u+=T,p=E,g.length>0){const[e,n,o,s]=this.drawStandardTooltipLabels(t,i,g,v,m,p,d);v=e,m=n,u+=s,p=o}const[D,M,P,k]=this.drawStandardTooltipIcons(t,i,{paneId:e,indicatorName:"",iconId:""},o,f,v,m,p);v=D,m=M,u+=k,p=P}return u}_drawRectTooltip(t,e,i,n,o,s,r,a,l,c,h,d,u,g){var v,m;const _=u.candle,x=u.indicator,f=_.tooltip,y=x.tooltip;if(h||d){const C=this._getCandleTooltipData(s.kLineData,r,a,l,c,_),{marginLeft:b,marginRight:w,marginTop:I,marginBottom:E,size:T,weight:D,family:M}=f.text,{paddingLeft:P,paddingRight:A,paddingTop:F,paddingBottom:L,offsetLeft:R,offsetRight:B,offsetTop:N,borderSize:V,borderRadius:O,borderColor:W,color:z}=f.rect;let Y=0,X=0,H=0;h&&(t.font=k(T,D,M),C.forEach((e=>{const i=e.title,n=e.value,o=`${i.text}${n.text}`,s=t.measureText(o).width+b+w;Y=Math.max(Y,s)})),H+=(E+I+T)*C.length);const{marginLeft:$,marginRight:j,marginTop:G,marginBottom:U,size:Z,weight:q,family:K}=y.text,J=[];if(d&&(t.font=k(Z,q,K),i.forEach((i=>{var n;const o=null!==(n=this.getIndicatorTooltipData(e,s,i,c,x).values)&&void 0!==n?n:[];J.push(o),o.forEach((e=>{const i=e.title,n=e.value,o=`${i.text}${n.text}`,s=t.measureText(o).width+$+j;Y=Math.max(Y,s),H+=G+U+Z}))}))),X+=Y,0!==X&&0!==H){X+=2*V+P+A,H+=2*V+F+L;const e=n.width/2;let i;(null!==(v=s.realX)&&void 0!==v?v:0)<e?(i=n.width-B-X,u.yAxis.inside&&u.yAxis.position===S.Right&&(i-=o.width)):(i=R,u.yAxis.inside&&u.yAxis.position===S.Left&&(i+=o.width));const r=g+N;null===(m=this.createFigure("rect",{x:i,y:r,width:X,height:H},{style:p.StrokeFill,color:z,borderColor:W,borderSize:V,borderRadius:O}))||void 0===m||m.draw(t);const a=i+V+P+b;let l=r+V+F;if(h&&C.forEach((e=>{var n,o;l+=I;const s=e.title;null===(n=this.createFigure("text",{x:a,y:l,text:s.text},{color:s.color,size:T,family:M,weight:D}))||void 0===n||n.draw(t);const r=e.value;null===(o=this.createFigure("text",{x:i+X-V-w-A,y:l,text:r.text,align:"right"},{color:r.color,size:T,family:M,weight:D}))||void 0===o||o.draw(t),l+=T+E})),d){const e=i+V+P+$;J.forEach((n=>{n.forEach((n=>{var o,s;l+=G;const r=n.title,a=n.value;null===(o=this.createFigure("text",{x:e,y:l,text:r.text},{color:r.color,size:Z,family:K,weight:q}))||void 0===o||o.draw(t),null===(s=this.createFigure("text",{x:i+X-V-j-A,y:l,text:a.text,align:"right"},{color:a.color,size:Z,family:K,weight:q}))||void 0===s||s.draw(t),l+=Z+U}))}))}}}}_getCandleTooltipData(t,e,i,n,r,a){var l,c,h;const d=a.tooltip,u=d.text.color;let v=[];if(o(d.custom))(null!==(c=null===(l=d.custom)||void 0===l?void 0:l.call(d,t,a))&&void 0!==c?c:[]).forEach((({title:t,value:e})=>{let i={text:"",color:""};s(t)?i=t:(i.text=t,i.color=u),i.text=we(i.text,n);let o={text:"",color:""};s(e)?o=e:(o.text=e,o.color=u),v.push({title:i,value:o})}));else{const{price:o,volume:s}=e;v=[{title:{text:we("time",n),color:u},value:{text:r.formatDate(i,t.timestamp,"YYYY-MM-DD HH:mm",b.Tooltip),color:u}},{title:{text:we("open",n),color:u},value:{text:g(t.open,o),color:u}},{title:{text:we("high",n),color:u},value:{text:g(t.high,o),color:u}},{title:{text:we("low",n),color:u},value:{text:g(t.low,o),color:u}},{title:{text:we("close",n),color:u},value:{text:g(t.close,o),color:u}},{title:{text:we("volume",n),color:u},value:{text:r.formatBigNumber(g(null!==(h=t.volume)&&void 0!==h?h:d.defaultValue,s)),color:u}}]}return v}}class Ee extends fe{constructor(){super(...arguments),this._candleBarView=new ve(this),this._candleAreaView=new ye(this),this._candleHighLowPriceView=new Se(this),this._candleLastPriceLineView=new Ce(this)}updateMainContent(t){this.getPane().getChart().getStyles().candle.type!==y.Area?(this._candleBarView.draw(t),this._candleHighLowPriceView.draw(t),this._candleLastPriceLineView.draw(t)):this._candleAreaView.draw(t)}createTooltipView(){return new Ie(this)}}class Te extends de{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),o=i.getBounding(),s=n.getAxisComponent(),r=this.getAxisStyles(n.getChart().getStyles());if(r.show){r.axisLine.show&&(null===(e=this.createFigure("line",this.createAxisLine(o,r),r.axisLine))||void 0===e||e.draw(t));const i=s.getTicks();r.tickLine.show&&this.createTickLines(i,o,r).forEach((e=>{var i;null===(i=this.createFigure("line",e,r.tickLine))||void 0===i||i.draw(t)})),r.tickText.show&&this.createTickTexts(i,o,r).forEach((e=>{var i;null===(i=this.createFigure("text",e,r.tickText))||void 0===i||i.draw(t)}))}}}class De extends Te{getAxisStyles(t){return t.yAxis}createAxisLine(t,e){const i=this.getWidget().getPane().getAxisComponent(),n=e.axisLine.size;let o;return o=i.isFromZero()?n/2:t.width-n,{coordinates:[{x:o,y:0},{x:o,y:t.height}]}}createTickLines(t,e,i){const n=this.getWidget().getPane().getAxisComponent(),o=i.axisLine,s=i.tickLine;let r=0,a=0;return n.isFromZero()?(r=0,o.show&&(r+=o.size),a=r+s.length):(r=e.width,o.show&&(r-=o.size),a=r-s.length),t.map((t=>({coordinates:[{x:r,y:t.coord},{x:a,y:t.coord}]})))}createTickTexts(t,e,i){const n=this.getWidget().getPane().getAxisComponent(),o=i.axisLine,s=i.tickLine,r=i.tickText;let a=0;n.isFromZero()?(a=r.marginStart,o.show&&(a+=o.size),s.show&&(a+=s.length)):(a=e.width-r.marginEnd,o.show&&(a-=o.size),s.show&&(a-=s.length));const l=this.getWidget().getPane().getAxisComponent().isFromZero()?"left":"right";return t.map((t=>({x:a,y:t.coord,text:t.text,align:l,baseline:"middle"})))}}class Me extends de{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),o=i.getBounding(),s=n.getChart().getChartStore(),r=s.getStyles().candle.priceMark,a=r.last,l=a.text;if(r.show&&a.show&&l.show){const i=s.getPrecision(),r=n.getAxisComponent(),c=s.getDataList(),h=s.getVisibleDataList(),d=c[c.length-1];if(void 0!==d){const{close:n,open:s}=d,c=r.convertToNicePixel(n);let u,v,m,p;if(u=n>s?a.upColor:n<s?a.downColor:a.noChangeColor,r.getType()===C.Percentage){const t=h[0].data.close;v=`${((n-t)/t*100).toFixed(2)}%`}else v=g(n,i.price);r.isFromZero()?(m=0,p="left"):(m=o.width,p="right"),null===(e=this.createFigure("rectText",{x:m,y:c,text:v,align:p,baseline:"middle"},{...l,backgroundColor:u}))||void 0===e||e.draw(t)}}}}class Pe extends de{drawImp(t){const e=this.getWidget(),i=e.getPane(),n=e.getBounding(),o=i.getChart().getChartStore(),s=o.getCustomApi(),r=o.getStyles().indicator,l=r.lastValueMark,c=l.text;if(l.show){const e=i.getAxisComponent(),l=o.getDataList(),h=l.length-1;o.getIndicatorStore().getInstances(i.getId()).forEach((i=>{const o=i.result[h];if(void 0!==o&&i.visible){const d=i.precision;Y(l,i,h,r,((r,l)=>{var h;const u=o[r.key];if(a(u)){const o=e.convertToNicePixel(u);let r,a,v=g(u,d);i.shouldFormatBigNumber&&(v=s.formatBigNumber(v)),e.isFromZero()?(r=0,a="left"):(r=n.width,a="right"),null===(h=this.createFigure("rectText",{x:r,y:o,text:v,align:a,baseline:"middle"},{...c,backgroundColor:l.color}))||void 0===h||h.draw(t)}}))}}))}}}class ke extends xe{coordinateToPointTimestampDataIndexFlag(){return!1}drawDefaultFigures(t,e,i,n,o,s,r,a,l,c,h,d){this.drawFigures(t,e,this.getDefaultFigures(e,i,n,o,s,r,l,c,d),a)}getDefaultFigures(t,e,i,n,o,s,r,a,l){var c,h;const d=[];if(t.needDefaultYAxisFigure&&t.id===(null===(c=l.instance)||void 0===c?void 0:c.id)&&l.paneId===this.getWidget().getPane().getId()){let o,s,r=Number.MAX_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER;null!==(h=null==a?void 0:a.isFromZero())&&void 0!==h&&h?(o="left",s=0):(o="right",s=i.width),e.forEach(((e,i)=>{const a=t.points[i];if(void 0!==a.value){r=Math.min(r,e.y),l=Math.max(l,e.y);const t=g(a.value,n.price);d.push({type:"rectText",attrs:{x:s,y:e.y,text:t,align:o,baseline:"middle"},ignoreEvent:!0})}})),e.length>1&&d.unshift({type:"rect",attrs:{x:0,y:r,width:i.width,height:l-r},ignoreEvent:!0})}return d}getFigures(t,e,i,n,o,s,r,a,l){var c,h;return null!==(h=null===(c=t.createYAxisFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:o,dateTimeFormat:s,defaultStyles:r,xAxis:a,yAxis:l}))&&void 0!==h?h:[]}}class Ae extends de{drawImp(t){var e;const i=this.getWidget(),n=i.getPane(),o=i.getBounding(),s=i.getPane().getChart().getChartStore(),r=s.getCrosshairStore().get(),a=s.getStyles().crosshair;if(void 0!==r.paneId&&void 0!==r.kLineData&&this.checkPaneId(r,n.getId())&&a.show){const i=this.getDirectionStyles(a),l=i.text;if(i.show&&l.show){const i=n.getAxisComponent(),a=this.getText(r,s,i);t.font=k(l.size,l.weight,l.family),null===(e=this.createFigure("rectText",this.getTextAttrs(a,t.measureText(a).width,r,o,i,l),l))||void 0===e||e.draw(t)}}}checkPaneId(t,e){return t.paneId===e}getDirectionStyles(t){return t.horizontal}getText(t,e,i){var n,o;const s=i,r=i.convertFromPixel(t.y);let a;if(s.getType()===C.Percentage){const t=null!==(o=null===(n=e.getVisibleDataList()[0])||void 0===n?void 0:n.data)&&void 0!==o?o:{};a=`${((r-t.close)/t.close*100).toFixed(2)}%`}else{const i=e.getIndicatorStore().getInstances(t.paneId);let n=0,o=!1;s.isInCandle()?n=e.getPrecision().price:i.forEach((t=>{n=Math.max(t.precision,n),o||(o=t.shouldFormatBigNumber)})),a=g(r,n),o&&(a=e.getCustomApi().formatBigNumber(a))}return a}getTextAttrs(t,e,i,n,o,s){let r,a;return o.isFromZero()?(r=0,a="left"):(r=n.width,a="right"),{x:r,y:i.y,text:t,align:a,baseline:"middle"}}}class Fe extends Gt{constructor(t,e){super(t,e),this._yAxisView=new De(this),this._candleLastPriceLabelView=new Me(this),this._indicatorLastValueView=new Pe(this),this._overlayYAxisView=new ke(this),this._crosshairHorizontalLabelView=new Ae(this),this.getContainer().style.cursor="ns-resize",this.addChild(this._overlayYAxisView)}getName(){return Ft}updateMain(t){this._yAxisView.draw(t),this.getPane().getAxisComponent().isInCandle()&&this._candleLastPriceLabelView.draw(t),this._indicatorLastValueView.draw(t)}updateOverlay(t){this._overlayYAxisView.draw(t),this._crosshairHorizontalLabelView.draw(t)}}class Le{constructor(t){this._extremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._prevExtremum={min:0,max:0,range:0,realMin:0,realMax:0,realRange:0},this._ticks=[],this._autoCalcTickFlag=!0,this._parent=t}getParent(){return this._parent}buildTicks(t){return this._autoCalcTickFlag&&(this._extremum=this.calcExtremum()),!(this._prevExtremum.min===this._extremum.min&&this._prevExtremum.max===this._extremum.max&&!t)&&(this._prevExtremum=this._extremum,this._ticks=this.optimalTicks(this._calcTicks()),!0)}getTicks(){return this._ticks}setExtremum(t){this._autoCalcTickFlag=!1,this._extremum=t}getExtremum(){return this._extremum}setAutoCalcTickFlag(t){this._autoCalcTickFlag=t}getAutoCalcTickFlag(){return this._autoCalcTickFlag}_calcTicks(){const{realMin:t,realMax:e,realRange:i}=this._extremum,n=[];if(i>=0){const[o,s]=this._calcTickInterval(i),r=L(Math.ceil(t/o)*o,s),a=L(Math.floor(e/o)*o,s);let l=0,c=r;if(0!==o)for(;c<=a;){const t=c.toFixed(s);n[l]={text:t,coord:0,value:t},++l,c+=o}}return n}_calcTickInterval(t){const e=function(t){const e=Math.floor(B(t)),i=N(e),n=t/i;let o=0;return o=n<1.5?1:n<2.5?2:n<3.5?3:n<4.5?4:n<5.5?5:n<6.5?6:8,t=o*i,e>=-20?+t.toFixed(e<0?-e:0):t}(t/8);return[e,function(t){const e=t.toString(),i=e.indexOf("e");if(i>0){const t=+e.slice(i+1);return t<0?-t:0}{const t=e.indexOf(".");return t<0?0:e.length-1-t}}(e)]}}class Re extends Le{calcExtremum(){var t,e,i,n,o;const s=this.getParent(),r=s.getChart(),l=r.getChartStore();let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;const d=[];let u=!1,g=Number.MAX_SAFE_INTEGER,v=Number.MIN_SAFE_INTEGER,m=Number.MAX_SAFE_INTEGER;l.getIndicatorStore().getInstances(s.getId()).forEach((t=>{var e,i,n;u||(u=null!==(e=t.shouldOhlc)&&void 0!==e&&e),m=Math.min(m,t.precision),null!==t.minValue&&(g=Math.min(g,t.minValue)),null!==t.maxValue&&(v=Math.max(v,t.maxValue)),d.push({figures:null!==(i=t.figures)&&void 0!==i?i:[],result:null!==(n=t.result)&&void 0!==n?n:[]})}));let p=4;const _=this.isInCandle();if(_){const{price:t}=l.getPrecision();p=m!==Number.MAX_SAFE_INTEGER?Math.min(m,t):t}else m!==Number.MAX_SAFE_INTEGER&&(p=m);const x=l.getVisibleDataList(),f=r.getStyles().candle,S=f.type===y.Area,b=f.area.value,w=_&&!S||!_&&u;x.forEach((({dataIndex:t,data:e})=>{w&&(c=Math.min(c,e.low),h=Math.max(h,e.high)),_&&S&&(c=Math.min(c,e[b]),h=Math.max(h,e[b])),d.forEach((({figures:e,result:i})=>{var n;const o=null!==(n=i[t])&&void 0!==n?n:{};e.forEach((t=>{const e=o[t.key];a(e)&&(c=Math.min(c,e),h=Math.max(h,e))}))}))})),c!==Number.MAX_SAFE_INTEGER&&h!==Number.MIN_SAFE_INTEGER?(c=Math.min(g,c),h=Math.max(v,h)):(c=0,h=10);const I=this.getType();let E;switch(I){case C.Percentage:{const e=null===(t=x[0])||void 0===t?void 0:t.data;void 0!==(null==e?void 0:e.close)&&(c=(c-e.close)/e.close*100,h=(h-e.close)/e.close*100),E=Math.pow(10,-2);break}case C.Log:c=B(c),h=B(h),E=.05*N(-p);break;default:E=N(-p)}if(c===h||Math.abs(c-h)<E){const t=g===c,e=v===h;c=t?c:e?c-8*E:c-4*E,h=e?h:t?h+8*E:h+4*E}const T=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{gap:D}=s.getOptions();let M=null!==(n=null==D?void 0:D.top)&&void 0!==n?n:.2;M>=1&&(M/=T);let P=null!==(o=null==D?void 0:D.bottom)&&void 0!==o?o:.1;P>=1&&(P/=T);let k,A,F,L=Math.abs(h-c);return c-=L*P,h+=L*M,L=Math.abs(h-c),I===C.Log?(k=N(c),A=N(h),F=Math.abs(A-k)):(k=c,A=h,F=L),{min:c,max:h,range:L,realMin:k,realMax:A,realRange:F}}_innerConvertToPixel(t){var e,i;const n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{min:o,range:s}=this.getExtremum(),r=(t-o)/s;return this.isReverse()?Math.round(r*n):Math.round((1-r)*n)}isInCandle(){return"candle"===this.getParent().getName()}getType(){return this.isInCandle()?this.getParent().getChart().getStyles().yAxis.type:C.Normal}getPosition(){return this.getParent().getChart().getStyles().yAxis.position}isReverse(){return!!this.isInCandle()&&this.getParent().getChart().getStyles().yAxis.reverse}isFromZero(){const t=this.getParent().getChart().getStyles().yAxis,e=t.inside;return t.position===S.Left&&e||t.position===S.Right&&!e}optimalTicks(t){var e,i;const n=this.getParent(),o=null!==(i=null===(e=n.getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,s=n.getChart().getChartStore(),r=s.getCustomApi(),a=[],l=this.getType(),c=s.getIndicatorStore().getInstances(n.getId());let h=0,d=!1;this.isInCandle()?h=s.getPrecision().price:c.forEach((t=>{h=Math.max(h,t.precision),d||(d=t.shouldFormatBigNumber)}));const u=s.getStyles().xAxis.tickText.size;let v;return t.forEach((({value:t})=>{let e,i=this._innerConvertToPixel(+t);switch(l){case C.Percentage:e=`${g(t,2)}%`;break;case C.Log:i=this._innerConvertToPixel(B(+t)),e=g(t,h);break;default:e=g(t,h),d&&(e=r.formatBigNumber(t))}i>u&&i<o-u&&(void 0!==v&&Math.abs(v-i)>2*u||void 0===v)&&(a.push({text:e,coord:i,value:t}),v=i)})),a}getAutoSize(){const t=this.getParent(),e=t.getChart(),i=e.getStyles(),n=i.yAxis,o=n.size;if("auto"!==o)return o;const s=e.getChartStore(),r=s.getCustomApi();let a=0;if(n.show&&(n.axisLine.show&&(a+=n.axisLine.size),n.tickLine.show&&(a+=n.tickLine.length),n.tickText.show)){let t=0;this.getTicks().forEach((e=>{t=Math.max(t,A(e.text,n.tickText.size,n.tickText.weight,n.tickText.family))})),a+=n.tickText.marginStart+n.tickText.marginEnd+t}const l=i.crosshair;let c=0;if(l.show&&l.horizontal.show&&l.horizontal.text.show){const e=s.getIndicatorStore().getInstances(t.getId());let n=0,o=!1;e.forEach((t=>{n=Math.max(t.precision,n),o||(o=t.shouldFormatBigNumber)}));let a=2;if(this.getType()!==C.Percentage)if(this.isInCandle()){const{price:t}=s.getPrecision(),e=i.indicator.lastValueMark;a=e.show&&e.text.show?Math.max(n,t):t}else a=n;let h=g(this.getExtremum().max,a);o&&(h=r.formatBigNumber(h)),c+=l.horizontal.text.paddingLeft+l.horizontal.text.paddingRight+2*l.horizontal.text.borderSize+A(h,l.horizontal.text.size,l.horizontal.text.weight,l.horizontal.text.family)}return Math.max(a,c)}convertFromPixel(t){var e,i,n;const o=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,{min:s,range:r}=this.getExtremum(),a=(this.isReverse()?t/o:1-t/o)*r+s;switch(this.getType()){case C.Percentage:{const t=null===(n=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===n?void 0:n.data;return void 0!==(null==t?void 0:t.close)?t.close*a/100+t.close:0}case C.Log:return N(a);default:return a}}convertToRealValue(t){let e=t;return this.getType()===C.Log&&(e=N(t)),e}convertToPixel(t){var e;let i=t;switch(this.getType()){case C.Percentage:{const n=null===(e=this.getParent().getChart().getChartStore().getVisibleDataList()[0])||void 0===e?void 0:e.data;void 0!==(null==n?void 0:n.close)&&(i=(t-n.close)/n.close*100);break}case C.Log:i=B(t);break;default:i=t}return this._innerConvertToPixel(i)}convertToNicePixel(t){var e,i;const n=null!==(i=null===(e=this.getParent().getYAxisWidget())||void 0===e?void 0:e.getBounding().height)&&void 0!==i?i:0,o=this.convertToPixel(t);return Math.round(Math.max(.05*n,Math.min(o,.98*n)))}}class Be extends Vt{getName(){return"indicator"}createAxisComponent(){return new Re(this)}createMainWidget(t){return new fe(t,this)}createSeparatorWidget(t){return new Bt(t,this)}creatYAxisWidget(t){return new Fe(t,this)}}class Ne extends Be{getName(){return"candle"}createMainWidget(t){return new Ee(t,this)}createSeparatorWidget(t){return null}}class Ve extends Te{getAxisStyles(t){return t.xAxis}createAxisLine(t,e){const i=e.axisLine.size/2;return{coordinates:[{x:0,y:i},{x:t.width,y:i}]}}createTickLines(t,e,i){const n=i.tickLine,o=i.axisLine.size;return t.map((t=>({coordinates:[{x:t.coord,y:0},{x:t.coord,y:o+n.length}]})))}createTickTexts(t,e,i){const n=i.tickText,o=i.axisLine.size,s=i.tickLine.length;return t.map((t=>({x:t.coord,y:o+s+n.marginStart,text:t.text,align:"center",baseline:"top"})))}}class Oe extends ke{coordinateToPointTimestampDataIndexFlag(){return!0}coordinateToPointValueFlag(){return!1}getCompleteOverlays(t){return t.getInstances()}getProgressOverlay(t){return t.instance}getDefaultFigures(t,e,i,n,o,s,r,a,l){var c;const h=[];if(t.needDefaultXAxisFigure&&t.id===(null===(c=l.instance)||void 0===c?void 0:c.id)){let n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;e.forEach(((e,i)=>{n=Math.min(n,e.x),r=Math.max(r,e.x);const a=t.points[i];if(void 0!==a.timestamp){const t=s.formatDate(o,a.timestamp,"YYYY-MM-DD HH:mm",b.Crosshair);h.push({type:"rectText",attrs:{x:e.x,y:0,text:t,align:"center"},ignoreEvent:!0})}})),e.length>1&&h.unshift({type:"rect",attrs:{x:n,y:0,width:r-n,height:i.height},ignoreEvent:!0})}return h}getFigures(t,e,i,n,o,s,r,a,l){var c,h;return null!==(h=null===(c=t.createXAxisFigures)||void 0===c?void 0:c.call(t,{overlay:t,coordinates:e,bounding:i,barSpace:n,precision:o,dateTimeFormat:s,defaultStyles:r,xAxis:a,yAxis:l}))&&void 0!==h?h:[]}}class We extends Ae{checkPaneId(t){return t.dataIndex===t.realDataIndex}getDirectionStyles(t){return t.vertical}getText(t,e,i){var n;const o=null===(n=t.kLineData)||void 0===n?void 0:n.timestamp;return e.getCustomApi().formatDate(e.getTimeScaleStore().getDateTimeFormat(),o,"YYYY-MM-DD HH:mm",b.Crosshair)}getTextAttrs(t,e,i,n,o,s){const r=i.realX;let a;return a=r-e/2-s.paddingLeft<0?s.paddingLeft+e/2:r+e/2+s.paddingRight>n.width?n.width-s.paddingRight-e/2:r,{x:a,y:0,text:t,align:"center",baseline:"top"}}}class ze extends Gt{constructor(t,e){super(t,e),this._xAxisView=new Ve(this),this._overlayXAxisView=new Oe(this),this._crosshairVerticalLabelView=new We(this),this.getContainer().style.cursor="ew-resize",this.addChild(this._overlayXAxisView)}getName(){return At}updateMain(t){this._xAxisView.draw(t)}updateOverlay(t){this._overlayXAxisView.draw(t),this._crosshairVerticalLabelView.draw(t)}}class Ye extends Le{calcExtremum(){const t=this.getParent().getChart().getChartStore(),{from:e,to:i}=t.getTimeScaleStore().getVisibleRange(),n=i-1,o=i-e;return{min:e,max:n,range:o,realMin:e,realMax:n,realRange:o}}optimalTicks(t){var e,i;const n=this.getParent().getChart(),o=n.getChartStore(),s=o.getCustomApi().formatDate,r=[],a=t.length,l=o.getDataList();if(a>0){const c=o.getTimeScaleStore().getDateTimeFormat(),h=n.getStyles().xAxis.tickText,d=A("00-00 00:00",h.size,h.weight,h.family),u=parseInt(t[0].value,10),g=this.convertToPixel(u);let v=1;if(a>1){const e=parseInt(t[1].value,10),i=this.convertToPixel(e),n=Math.abs(i-g);n<d&&(v=Math.ceil(d/n))}for(let i=0;i<a;i+=v){const n=parseInt(t[i].value,10),o=l[n].timestamp;let a=s(c,o,"HH:mm",b.XAxis);if(0!==i){const n=l[parseInt(t[i-v].value,10)].timestamp;a=null!==(e=this._optimalTickLabel(s,c,o,n))&&void 0!==e?e:a}const h=this.convertToPixel(n);r.push({text:a,coord:h,value:o})}if(1===r.length)r[0].text=s(c,r[0].value,"YYYY-MM-DD HH:mm",b.XAxis);else{const t=r[0].value,e=r[1].value;if(void 0!==r[2]){const e=r[2].text;/^[0-9]{2}-[0-9]{2}$/.test(e)?r[0].text=s(c,t,"MM-DD",b.XAxis):/^[0-9]{4}-[0-9]{2}$/.test(e)?r[0].text=s(c,t,"YYYY-MM",b.XAxis):/^[0-9]{4}$/.test(e)&&(r[0].text=s(c,t,"YYYY",b.XAxis))}else r[0].text=null!==(i=this._optimalTickLabel(s,c,t,e))&&void 0!==i?i:r[0].text}}return r}_optimalTickLabel(t,e,i,n){const o=t(e,i,"YYYY",b.XAxis),s=t(e,i,"YYYY-MM",b.XAxis),r=t(e,i,"MM-DD",b.XAxis);return o!==t(e,n,"YYYY",b.XAxis)?o:s!==t(e,n,"YYYY-MM",b.XAxis)?s:r!==t(e,n,"MM-DD",b.XAxis)?r:null}getAutoSize(){const t=this.getParent().getChart().getStyles(),e=t.xAxis,i=e.size;if("auto"!==i)return i;const n=t.crosshair;let o=0;e.show&&(e.axisLine.show&&(o+=e.axisLine.size),e.tickLine.show&&(o+=e.tickLine.length),e.tickText.show&&(o+=e.tickText.marginStart+e.tickText.marginEnd+e.tickText.size));let s=0;return n.show&&n.vertical.show&&n.vertical.text.show&&(s+=n.vertical.text.paddingTop+n.vertical.text.paddingBottom+2*n.vertical.text.borderSize+n.vertical.text.size),Math.max(o,s)}convertFromPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().coordinateToDataIndex(t)}convertToPixel(t){return this.getParent().getChart().getChartStore().getTimeScaleStore().dataIndexToCoordinate(t)}}class Xe extends Vt{getName(){return"xAxis"}createAxisComponent(){return new Ye(this)}createMainWidget(t){return new ze(t,this)}}function He(){var t;return"undefined"!=typeof window&&(null!==(t=window.navigator.userAgent.toLowerCase().indexOf("firefox"))&&void 0!==t?t:-1)>-1}function $e(){return"undefined"!=typeof window&&/iPhone|iPad|iPod/.test(window.navigator.platform)}class je{constructor(t,e,i){this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY},this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartCoordinate=null,this._touchMoveStartCoordinate=null,this._touchMoveExceededManhattanDistance=!1,this._cancelClick=!1,this._cancelTap=!1,this._unsubscribeOutsideMouseEvents=null,this._unsubscribeOutsideTouchEvents=null,this._unsubscribeMobileSafariEvents=null,this._unsubscribeMousemove=null,this._unsubscribeMouseWheel=null,this._unsubscribeContextMenu=null,this._unsubscribeRootMouseEvents=null,this._unsubscribeRootTouchEvents=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventTouchDragProcess=!1,this._mousePressed=!1,this._lastTouchEventTimeStamp=0,this._activeTouchId=null,this._acceptMouseLeave=!$e(),this._onFirefoxOutsideMouseUp=t=>{this._mouseUpHandler(t)},this._onMobileSafariDoubleClick=t=>{if(this._firesTouchEvents(t)){if(++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:e}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._tapCoordinate);e<30&&!this._cancelTap&&this._processEvent(this._makeCompatEvent(t),this._handler.doubleTapEvent),this._resetTapTimeout()}}else if(++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:e}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);e<5&&!this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}},this._target=t,this._handler=e,this._options=i,this._init()}destroy(){null!==this._unsubscribeOutsideMouseEvents&&(this._unsubscribeOutsideMouseEvents(),this._unsubscribeOutsideMouseEvents=null),null!==this._unsubscribeOutsideTouchEvents&&(this._unsubscribeOutsideTouchEvents(),this._unsubscribeOutsideTouchEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeMouseWheel&&(this._unsubscribeMouseWheel(),this._unsubscribeMouseWheel=null),null!==this._unsubscribeContextMenu&&(this._unsubscribeContextMenu(),this._unsubscribeContextMenu=null),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null),null!==this._unsubscribeMobileSafariEvents&&(this._unsubscribeMobileSafariEvents(),this._unsubscribeMobileSafariEvents=null),this._clearLongTapTimeout(),this._resetClickTimeout()}_mouseEnterHandler(t){var e,i,n;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this);const o=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=()=>{this._target.removeEventListener("mousemove",o)},this._target.addEventListener("mousemove",o);const s=this._mouseWheelHandler.bind(this);this._unsubscribeMouseWheel=()=>{this._target.removeEventListener("wheel",s)},this._target.addEventListener("wheel",s,{passive:!1});const r=this._contextMenuHandler.bind(this);this._unsubscribeContextMenu=()=>{this._target.removeEventListener("contextmenu",r)},this._target.addEventListener("contextmenu",r,{passive:!1}),this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseEnterEvent),this._acceptMouseLeave=!0)}_resetClickTimeout(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null,this._clickCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_resetTapTimeout(){null!==this._tapTimeoutId&&clearTimeout(this._tapTimeoutId),this._tapCount=0,this._tapTimeoutId=null,this._tapCoordinate={x:Number.NEGATIVE_INFINITY,y:Number.POSITIVE_INFINITY}}_mouseMoveHandler(t){this._mousePressed||null!==this._touchMoveStartCoordinate||this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseMoveEvent),this._acceptMouseLeave=!0)}_mouseWheelHandler(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(void 0===this._handler.mouseWheelHortEvent)return;if(this._preventDefault(t),0===Math.abs(t.deltaX))return;this._handler.mouseWheelHortEvent(this._makeCompatEvent(t),-t.deltaX)}else{if(void 0===this._handler.mouseWheelVertEvent)return;let e=-t.deltaY/100;if(0===e)return;switch(this._preventDefault(t),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){const i=Math.sign(e)*Math.min(1,Math.abs(e));this._handler.mouseWheelVertEvent(this._makeCompatEvent(t),i)}}}_contextMenuHandler(t){this._preventDefault(t)}_touchMoveHandler(t){const e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e)return;if(this._lastTouchEventTimeStamp=this._eventTimeStamp(t),null!==this._startPinchMiddleCoordinate)return;if(this._preventTouchDragProcess)return;this._pinchPrevented=!0;const i=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._touchMoveStartCoordinate),{xOffset:n,yOffset:o,manhattanDistance:s}=i;if(this._touchMoveExceededManhattanDistance||!(s<5)){if(!this._touchMoveExceededManhattanDistance){const t=.5*n,e=o>=t&&!this._options.treatVertDragAsPageScroll(),i=t>o&&!this._options.treatHorzDragAsPageScroll();e||i||(this._preventTouchDragProcess=!0),this._touchMoveExceededManhattanDistance=!0,this._cancelTap=!0,this._clearLongTapTimeout(),this._resetTapTimeout()}this._preventTouchDragProcess||this._processEvent(this._makeCompatEvent(t,e),this._handler.touchMoveEvent)}}_mouseMoveWithDownHandler(t){if(0!==t.button)return;const e=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._mouseMoveStartCoordinate),{manhattanDistance:i}=e;i>=5&&(this._cancelClick=!0,this._resetClickTimeout()),this._cancelClick&&this._processEvent(this._makeCompatEvent(t),this._handler.pressedMouseMoveEvent)}_mouseTouchMoveWithDownInfo(t,e){const i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return{xOffset:i,yOffset:n,manhattanDistance:i+n}}_touchEndHandler(t){let e=this._touchWithId(t.changedTouches,this._activeTouchId);if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null===e)return;this._activeTouchId=null,this._lastTouchEventTimeStamp=this._eventTimeStamp(t),this._clearLongTapTimeout(),this._touchMoveStartCoordinate=null,null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);const i=this._makeCompatEvent(t,e);if(this._processEvent(i,this._handler.touchEndEvent),++this._tapCount,null!==this._tapTimeoutId&&this._tapCount>1){const{manhattanDistance:t}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(e),this._tapCoordinate);t<30&&!this._cancelTap&&this._processEvent(i,this._handler.doubleTapEvent),this._resetTapTimeout()}else this._cancelTap||(this._processEvent(i,this._handler.tapEvent),void 0!==this._handler.tapEvent&&this._preventDefault(t));0===this._tapCount&&this._preventDefault(t),0===t.touches.length&&this._longTapActive&&(this._longTapActive=!1,this._preventDefault(t))}_mouseUpHandler(t){if(0!==t.button)return;const e=this._makeCompatEvent(t);if(this._mouseMoveStartCoordinate=null,this._mousePressed=!1,null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null),He()&&this._target.ownerDocument.documentElement.removeEventListener("mouseleave",this._onFirefoxOutsideMouseUp),!this._firesTouchEvents(t))if(this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,null!==this._clickTimeoutId&&this._clickCount>1){const{manhattanDistance:i}=this._mouseTouchMoveWithDownInfo(this._getCoordinate(t),this._clickCoordinate);i<5&&!this._cancelClick&&this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()}else this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent)}_clearLongTapTimeout(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}_touchStartHandler(t){if(null!==this._activeTouchId)return;const e=t.changedTouches[0];this._activeTouchId=e.identifier,this._lastTouchEventTimeStamp=this._eventTimeStamp(t);const i=this._target.ownerDocument.documentElement;this._cancelTap=!1,this._touchMoveExceededManhattanDistance=!1,this._preventTouchDragProcess=!1,this._touchMoveStartCoordinate=this._getCoordinate(e),null!==this._unsubscribeRootTouchEvents&&(this._unsubscribeRootTouchEvents(),this._unsubscribeRootTouchEvents=null);{const e=this._touchMoveHandler.bind(this),n=this._touchEndHandler.bind(this);this._unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",e),i.removeEventListener("touchend",n)},i.addEventListener("touchmove",e,{passive:!1}),i.addEventListener("touchend",n,{passive:!1}),this._clearLongTapTimeout(),this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),240)}this._processEvent(this._makeCompatEvent(t,e),this._handler.touchStartEvent),null===this._tapTimeoutId&&(this._tapCount=0,this._tapTimeoutId=setTimeout(this._resetTapTimeout.bind(this),500),this._tapCoordinate=this._getCoordinate(e))}_mouseDownHandler(t){if(2===t.button)return this._preventDefault(t),void this._processEvent(this._makeCompatEvent(t),this._handler.mouseRightClickEvent);if(0!==t.button)return;const e=this._target.ownerDocument.documentElement;He()&&e.addEventListener("mouseleave",this._onFirefoxOutsideMouseUp),this._cancelClick=!1,this._mouseMoveStartCoordinate=this._getCoordinate(t),null!==this._unsubscribeRootMouseEvents&&(this._unsubscribeRootMouseEvents(),this._unsubscribeRootMouseEvents=null);{const t=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this);this._unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",t),e.addEventListener("mouseup",i)}this._mousePressed=!0,this._firesTouchEvents(t)||(this._processEvent(this._makeCompatEvent(t),this._handler.mouseDownEvent),null===this._clickTimeoutId&&(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500),this._clickCoordinate=this._getCoordinate(t)))}_init(){this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));{const t=this._target.ownerDocument,e=t=>{null!=this._handler.mouseDownOutsideEvent&&(t.composed&&this._target.contains(t.composedPath()[0])||null!==t.target&&this._target.contains(t.target)||this._handler.mouseDownOutsideEvent({x:0,y:0,pageX:0,pageY:0}))};this._unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}$e()&&(this._unsubscribeMobileSafariEvents=()=>{this._target.removeEventListener("dblclick",this._onMobileSafariDoubleClick)},this._target.addEventListener("dblclick",this._onMobileSafariDoubleClick)),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._touchStartHandler.bind(this),{passive:!0}),"undefined"!=typeof window&&void 0!==window.chrome&&(this._target.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1})),this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(()=>{}),{passive:!1}))}_initPinch(){void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(t=>this._checkPinchState(t.touches)),{passive:!0}),this._target.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this._startPinchMiddleCoordinate&&void 0!==this._handler.pinchEvent){const e=this._getTouchDistance(t.touches[0],t.touches[1])/this._startPinchDistance;this._handler.pinchEvent({...this._startPinchMiddleCoordinate,pageX:0,pageY:0},e),this._preventDefault(t)}}),{passive:!1}),this._target.addEventListener("touchend",(t=>{this._checkPinchState(t.touches)})))}_checkPinchState(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}_startPinch(t){var e;const i=null!==(e=this._target.getBoundingClientRect())&&void 0!==e?e:{left:0,top:0};this._startPinchMiddleCoordinate={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this._startPinchDistance=this._getTouchDistance(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent({x:0,y:0,pageX:0,pageY:0}),this._clearLongTapTimeout()}_stopPinch(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent({x:0,y:0,pageX:0,pageY:0}))}_mouseLeaveHandler(t){var e,i,n;null===(e=this._unsubscribeMousemove)||void 0===e||e.call(this),null===(i=this._unsubscribeMouseWheel)||void 0===i||i.call(this),null===(n=this._unsubscribeContextMenu)||void 0===n||n.call(this),this._firesTouchEvents(t)||this._acceptMouseLeave&&(this._processEvent(this._makeCompatEvent(t),this._handler.mouseLeaveEvent),this._acceptMouseLeave=!$e())}_longTapHandler(t){const e=this._touchWithId(t.touches,this._activeTouchId);null!==e&&(this._processEvent(this._makeCompatEvent(t,e),this._handler.longTapEvent),this._cancelTap=!0,this._longTapActive=!0)}_firesTouchEvents(t){var e;return void 0!==(null===(e=t.sourceCapabilities)||void 0===e?void 0:e.firesTouchEvents)?t.sourceCapabilities.firesTouchEvents:this._eventTimeStamp(t)<this._lastTouchEventTimeStamp+500}_processEvent(t,e){null==e||e.call(this._handler,t)}_makeCompatEvent(t,e){var i;const n=null!=e?e:t,o=null!==(i=this._target.getBoundingClientRect())&&void 0!==i?i:{left:0,top:0};return{x:n.clientX-o.left,y:n.clientY-o.top,pageX:n.pageX,pageY:n.pageY,isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,preventDefault:()=>{"touchstart"!==t.type&&this._preventDefault(t)}}}_getTouchDistance(t,e){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}_preventDefault(t){t.cancelable&&t.preventDefault()}_getCoordinate(t){return{x:t.pageX,y:t.pageY}}_eventTimeStamp(t){var e;return null!==(e=t.timeStamp)&&void 0!==e?e:performance.now()}_touchWithId(t,e){for(let i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null}}class Ge{constructor(t,e){this._flingStartTime=(new Date).getTime(),this._flingScrollTimerId=null,this._startScrollCoordinate=null,this._touchCoordinate=null,this._touchCancelCrosshair=!1,this._touchZoomed=!1,this._pinchScale=1,this._mouseDownWidget=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,this._mouseMoveTriggerWidgetInfo={pane:null,widget:null},this._boundKeyBoardDownEvent=t=>{if(t.shiftKey)switch(t.code){case"Equal":this._chart.getChartStore().getTimeScaleStore().zoom(.5);break;case"Minus":this._chart.getChartStore().getTimeScaleStore().zoom(-.5);break;case"ArrowLeft":{const t=this._chart.getChartStore().getTimeScaleStore();t.startScroll(),t.scroll(-3*t.getBarSpace().bar);break}case"ArrowRight":{const t=this._chart.getChartStore().getTimeScaleStore();t.startScroll(),t.scroll(3*t.getBarSpace().bar);break}}},this._container=t,this._chart=e,this._event=new je(t,this,{treatVertDragAsPageScroll:()=>!1,treatHorzDragAsPageScroll:()=>!1}),t.addEventListener("keydown",this._boundKeyBoardDownEvent)}pinchStartEvent(){return this._touchZoomed=!0,this._pinchScale=1,!0}pinchEvent(t,e){const{pane:i,widget:n}=this._findWidgetByEvent(t);if((null==i?void 0:i.getId())!==Nt.XAXIS&&(null==n?void 0:n.getName())===kt){const i=this._makeWidgetEvent(t,n),o=5*(e-this._pinchScale);return this._pinchScale=e,this._chart.getChartStore().getTimeScaleStore().zoom(o,{x:i.x,y:i.y}),!0}return!1}mouseWheelHortEvent(t,e){const i=this._chart.getChartStore().getTimeScaleStore();return i.startScroll(),i.scroll(e),!0}mouseWheelVertEvent(t,e){var i,n;const{widget:o}=this._findWidgetByEvent(t),s=null!==(i=t.isTouch)&&void 0!==i&&i,r=this._makeWidgetEvent(t,o);let a=null;const l=null==o?void 0:o.getName();if(s)if(l===kt||l===At)a={x:r.x,y:r.y};else{const t=null===(n=this._chart.getPaneById(Nt.CANDLE))||void 0===n?void 0:n.getBounding();a={x:t.width/2,y:t.height/2}}else l===kt&&(a={x:r.x,y:r.y});return null!==a&&(this._chart.getChartStore().getTimeScaleStore().zoom(e,{x:r.x,y:r.y}),!0)}mouseDownEvent(t){var e,i;const{pane:n,widget:o}=this._findWidgetByEvent(t);if(this._mouseDownWidget=o,null!==o){const s=this._makeWidgetEvent(t,o);switch(o.getName()){case Lt:return o.dispatchEvent("mouseDownEvent",s);case kt:{const t=null!==(e=null==n?void 0:n.getAxisComponent().getExtremum())&&void 0!==e?e:null;return this._prevYAxisExtremum=null===t?t:{...t},this._startScrollCoordinate={x:s.x,y:s.y},this._chart.getChartStore().getTimeScaleStore().startScroll(),o.dispatchEvent("mouseDownEvent",s)}case At:{const t=o.dispatchEvent("mouseDownEvent",s);return t&&this._chart.updatePane(1),this._xAxisStartScaleCoordinate={x:s.x,y:s.y},this._xAxisStartScaleDistance=s.pageX,t}case Ft:{const t=o.dispatchEvent("mouseDownEvent",s);t&&this._chart.updatePane(1);const e=null!==(i=null==n?void 0:n.getAxisComponent().getExtremum())&&void 0!==i?i:null;return this._prevYAxisExtremum=null===e?e:{...e},this._yAxisStartScaleDistance=s.pageY,t}}}return!1}mouseMoveEvent(t){var e,i,n;const{pane:o,widget:s}=this._findWidgetByEvent(t),r=this._makeWidgetEvent(t,s);if((null===(e=this._mouseMoveTriggerWidgetInfo.pane)||void 0===e?void 0:e.getId())===(null==o?void 0:o.getId())&&(null===(i=this._mouseMoveTriggerWidgetInfo.widget)||void 0===i?void 0:i.getName())===(null==s?void 0:s.getName())||(null==s||s.dispatchEvent("mouseEnterEvent",r),null===(n=this._mouseMoveTriggerWidgetInfo.widget)||void 0===n||n.dispatchEvent("mouseLeaveEvent",r),this._mouseMoveTriggerWidgetInfo={pane:o,widget:s}),null!==s)switch(s.getName()){case kt:{const t=s.dispatchEvent("mouseMoveEvent",r),e=this._chart.getChartStore();let i={x:r.x,y:r.y,paneId:null==o?void 0:o.getId()};return t&&null!==e.getTooltipStore().getActiveIconInfo()&&(i=void 0,null!==s&&(s.getContainer().style.cursor="pointer")),this._chart.getChartStore().getCrosshairStore().set(i),t}case Lt:case At:case Ft:{const t=s.dispatchEvent("mouseMoveEvent",r);return this._chart.getChartStore().getCrosshairStore().set(),t}}return!1}pressedMouseMoveEvent(t){var e,i,n,o;if(null!==this._mouseDownWidget&&this._mouseDownWidget.getName()===Lt)return this._mouseDownWidget.dispatchEvent("pressedMouseMoveEvent",t);const{pane:s,widget:r}=this._findWidgetByEvent(t);if(null!==r&&(null===(e=this._mouseDownWidget)||void 0===e?void 0:e.getPane().getId())===(null==s?void 0:s.getId())&&(null===(i=this._mouseDownWidget)||void 0===i?void 0:i.getName())===r.getName()){const e=this._makeWidgetEvent(t,r);switch(r.getName()){case kt:{const t=r.getBounding(),i=r.dispatchEvent("pressedMouseMoveEvent",e);if(!i&&null!==this._startScrollCoordinate){const i=null==s?void 0:s.getAxisComponent();if(null!==this._prevYAxisExtremum&&!i.getAutoCalcTickFlag()){const{min:o,max:s,range:r}=this._prevYAxisExtremum;let a;a=null!==(n=null==i?void 0:i.isReverse())&&void 0!==n&&n?this._startScrollCoordinate.y-e.y:e.y-this._startScrollCoordinate.y;const l=r*(a/t.height),c=o+l,h=s+l,d=i.convertToRealValue(c),u=i.convertToRealValue(h);i.setExtremum({min:c,max:h,range:h-c,realMin:d,realMax:u,realRange:u-d})}const o=e.x-this._startScrollCoordinate.x;this._chart.getChartStore().getTimeScaleStore().scroll(o)}return this._chart.getChartStore().getCrosshairStore().set({x:e.x,y:e.y,paneId:null==s?void 0:s.getId()}),i}case At:{const t=r.dispatchEvent("pressedMouseMoveEvent",e);if(t)this._chart.updatePane(1);else{const t=this._xAxisStartScaleDistance/e.pageX,i=10*(t-this._xAxisScale);this._xAxisScale=t,this._chart.getChartStore().getTimeScaleStore().zoom(i,null!==(o=this._xAxisStartScaleCoordinate)&&void 0!==o?o:void 0)}return t}case Ft:{const t=r.dispatchEvent("pressedMouseMoveEvent",e);if(t)this._chart.updatePane(1);else if(null!==this._prevYAxisExtremum){const{min:t,max:i,range:n}=this._prevYAxisExtremum,o=n*(e.pageY/this._yAxisStartScaleDistance),r=(o-n)/2,a=t-r,l=i+r,c=null==s?void 0:s.getAxisComponent(),h=c.convertToRealValue(a),d=c.convertToRealValue(l);c.setExtremum({min:a,max:l,range:o,realMin:h,realMax:d,realRange:d-h}),this._chart.adjustPaneViewport(!1,!0,!0,!0)}return t}}}return!1}mouseUpEvent(t){const{widget:e}=this._findWidgetByEvent(t);let i=!1;if(null!==e){const n=this._makeWidgetEvent(t,e);switch(e.getName()){case kt:case Lt:case At:case Ft:i=e.dispatchEvent("mouseUpEvent",n)}i&&this._chart.updatePane(1)}return this._mouseDownWidget=null,this._startScrollCoordinate=null,this._prevYAxisExtremum=null,this._xAxisStartScaleCoordinate=null,this._xAxisStartScaleDistance=0,this._xAxisScale=1,this._yAxisStartScaleDistance=0,i}mouseRightClickEvent(t){const{widget:e}=this._findWidgetByEvent(t);let i=!1;if(null!==e){const n=this._makeWidgetEvent(t,e);switch(e.getName()){case kt:case At:case Ft:i=e.dispatchEvent("mouseRightClickEvent",n)}i&&this._chart.updatePane(1)}return!1}mouseDoubleClickEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===Ft){const t=null==e?void 0:e.getAxisComponent();if(!t.getAutoCalcTickFlag())return t.setAutoCalcTickFlag(!0),this._chart.adjustPaneViewport(!1,!0,!0,!0),!0}return!1}mouseLeaveEvent(){return this._chart.getChartStore().getCrosshairStore().set(),!0}touchStartEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i){const n=this._makeWidgetEvent(t,i);switch(i.getName()){case kt:{const t=this._chart.getChartStore(),o=t.getCrosshairStore();if(i.dispatchEvent("mouseDownEvent",n))return this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.set(void 0,!0),this._chart.updatePane(1),!0;if(null!==this._flingScrollTimerId&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null),this._flingStartTime=(new Date).getTime(),this._startScrollCoordinate={x:n.x,y:n.y},t.getTimeScaleStore().startScroll(),this._touchZoomed=!1,null!==this._touchCoordinate){const t=n.x-this._touchCoordinate.x,i=n.y-this._touchCoordinate.y;Math.sqrt(t*t+i*i)<10?(this._touchCoordinate={x:n.x,y:n.y},o.set({x:n.x,y:n.y,paneId:null==e?void 0:e.getId()})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,o.set())}else this._touchCancelCrosshair=!1;return!0}case At:case Ft:{const t=i.dispatchEvent("mouseDownEvent",n);return t&&this._chart.updatePane(1),t}}}return!1}touchMoveEvent(t){var e,i,n;const{pane:o,widget:s}=this._findWidgetByEvent(t);if(null!==s){const r=this._makeWidgetEvent(t,s);switch(s.getName()){case kt:{if(s.dispatchEvent("pressedMouseMoveEvent",r))return null===(e=r.preventDefault)||void 0===e||e.call(r),this._chart.updatePane(1),!0;const t=this._chart.getChartStore();if(null!==this._touchCoordinate)null===(i=r.preventDefault)||void 0===i||i.call(r),t.getCrosshairStore().set({x:r.x,y:r.y,paneId:null==o?void 0:o.getId()});else if(null!==this._startScrollCoordinate&&Math.abs(this._startScrollCoordinate.x-r.x)>this._startScrollCoordinate.y-r.y){const e=r.x-this._startScrollCoordinate.x;t.getTimeScaleStore().scroll(e)}return!0}case At:case Ft:{const t=s.dispatchEvent("pressedMouseMoveEvent",r);return t&&(null===(n=r.preventDefault)||void 0===n||n.call(r),this._chart.updatePane(1)),t}}}return!1}touchEndEvent(t){const{widget:e}=this._findWidgetByEvent(t);if(null!==e){const i=this._makeWidgetEvent(t,e);switch(e.getName()){case kt:if(e.dispatchEvent("mouseUpEvent",i),null!==this._startScrollCoordinate){const t=(new Date).getTime()-this._flingStartTime;let e=(i.x-this._startScrollCoordinate.x)/(t>0?t:1)*20;if(t<200&&Math.abs(e)>0){const t=this._chart.getChartStore().getTimeScaleStore(),i=()=>{this._flingScrollTimerId=setTimeout((()=>{t.startScroll(),t.scroll(e),e*=.975,Math.abs(e)<1?null!==this._flingScrollTimerId&&(clearTimeout(this._flingScrollTimerId),this._flingScrollTimerId=null):i()}),20)};i()}}return!0;case At:case Ft:e.dispatchEvent("mouseUpEvent",i)&&this._chart.updatePane(1)}}return!1}tapEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===kt&&null===this._touchCoordinate&&!this._touchCancelCrosshair&&!this._touchZoomed){const n=this._makeWidgetEvent(t,i);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().getCrosshairStore().set({x:n.x,y:n.y,paneId:null==e?void 0:e.getId()}),!0}return!1}longTapEvent(t){const{pane:e,widget:i}=this._findWidgetByEvent(t);if(null!==i&&i.getName()===kt){const n=this._makeWidgetEvent(t,i);return this._touchCoordinate={x:n.x,y:n.y},this._chart.getChartStore().getCrosshairStore().set({x:n.x,y:n.y,paneId:null==e?void 0:e.getId()}),!0}return!1}_findWidgetByEvent(t){const e=this._chart.getAllPanes(),{x:i,y:n}=t;let o=null;for(const[,r]of e){const t=r.getBounding();if(i>=t.left&&i<=t.left+t.width&&n>=t.top&&n<=t.top+t.height){o=r;break}}null===o&&(o=this._chart.getPaneById(Nt.XAXIS));let s=null;if(null!==o){const t=o.getSeparatorWidget();if(null!==t){const e=t.getBounding();i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+7&&(s=t)}if(null===s){const t=o.getMainWidget(),e=t.getBounding();i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+e.height&&(s=t)}if(null===s){const t=o.getYAxisWidget();if(null!==t){const e=t.getBounding();i>=e.left&&i<=e.left+e.width&&n>=e.top&&n<=e.top+e.height&&(s=t)}}}return{pane:o,widget:s}}_makeWidgetEvent(t,e){var i,n,o;const s=null!==(i=null==e?void 0:e.getBounding())&&void 0!==i?i:null;return{...t,x:t.x-(null!==(n=null==s?void 0:s.left)&&void 0!==n?n:0),y:t.y-(null!==(o=null==s?void 0:s.top)&&void 0!==o?o:0)}}destroy(){this._container.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._event.destroy()}}var Ue;!function(t){t.Root="root",t.Main="main",t.YAxis="yAxis"}(Ue||(Ue={}));class Ze{constructor(t,e){this._panes=new Map,this._initContainer(t),this._chartEvent=new Ge(this._chartContainer,this),this._chartStore=new Xt(this,e),this._xAxisPane=new Xe(this._chartContainer,this,Nt.XAXIS),this._panes.set(Nt.CANDLE,new Ne(this._chartContainer,this,Nt.CANDLE)),this.adjustPaneViewport(!0,!0,!0)}_initContainer(t){this._container=t,this._chartContainer=D("div",{position:"relative",width:"100%",outline:"none",borderStyle:"none",cursor:"crosshair",boxSizing:"border-box",userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}_measurePaneHeight(){var t;const e=this._container.offsetHeight,i=this._xAxisPane.getAxisComponent().getAutoSize();let n=e-i;n<0&&(n=0);let o=0;this._panes.forEach((t=>{if(t.getId()!==Nt.CANDLE){let e=t.getBounding().height;const i=t.getOptions().minHeight;e<i&&(e=i),o+e>n?(o=n,e=Math.max(n-o,0)):o+=e,t.setBounding({height:e})}}));const s=n-o;null===(t=this._panes.get(Nt.CANDLE))||void 0===t||t.setBounding({height:s});let r=0;this._panes.forEach((t=>{t.setBounding({top:r}),r+=t.getBounding().height})),this._xAxisPane.setBounding({height:i,top:r})}_measurePaneWidth(){const t=this._chartStore.getStyles().yAxis,e=t.position===S.Left,i=!t.inside,n=this._container.offsetWidth;let o=0,s=Number.MIN_SAFE_INTEGER,r=0,a=0;this._panes.forEach((t=>{s=Math.max(s,t.getAxisComponent().getAutoSize())})),s>n&&(s=n),i?(o=n-s,e?(r=0,a=s):(r=n-s,a=0)):(o=n,a=0,r=e?0:n-s),this._chartStore.getTimeScaleStore().setTotalBarSpace(o);const l={width:n},c={width:o,left:a},h={width:s,left:r};this._panes.forEach((t=>{t.setBounding(l,c,h)})),this._xAxisPane.setBounding(l,c,h)}_setPaneOptions(t,e){var i,n;const o=this._panes.get(null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"");let s=!1;if(void 0!==o){let i=e;if(t.id!==Nt.CANDLE&&void 0!==t.height&&t.height>0){const e=Math.max(null!==(n=t.minHeight)&&void 0!==n?n:o.getOptions().minHeight,0),r=Math.max(e,t.height);o.setBounding({height:r}),i=!0,s=!0}o.setOptions(t),i&&this.adjustPaneViewport(s,!0,!0,!0,!0)}}getContainer(){return this._container}getChartStore(){return this._chartStore}getAllPanes(){return this._panes}adjustPaneViewport(t,e,i,n,o){t&&this._measurePaneHeight();let s=e;const r=null!=o&&o;(null!=n&&n||r)&&this._panes.forEach((t=>{const e=t.getAxisComponent().buildTicks(r);s||(s=e)})),s&&this._measurePaneWidth(),null!=i&&i&&(this._xAxisPane.getAxisComponent().buildTicks(!0),this.updatePane(4))}updatePane(t,e){var i;void 0!==e?null===(i=this.getPaneById(e))||void 0===i||i.update(t):(this._xAxisPane.update(t),this._panes.forEach((e=>{e.update(t)})))}getPaneById(t){var e;return t===Nt.XAXIS?this._xAxisPane:null!==(e=this._panes.get(t))&&void 0!==e?e:null}crosshairChange(t){const e=this._chartStore.getActionStore();if(e.has(w.OnCrosshairChange)){const i={};this._panes.forEach(((e,n)=>{const o={};this._chartStore.getIndicatorStore().getInstances(n).forEach((e=>{var i;const n=e.result;o[e.name]=n[null!==(i=t.dataIndex)&&void 0!==i?i:n.length-1]})),i[n]=o})),void 0!==t.paneId&&e.execute(w.OnCrosshairChange,{...t,indicatorData:i})}}getDom(t,e){var i,n;if(void 0===t)return this._chartContainer;{const o=this.getPaneById(t);if(null!==o)switch(null!=e?e:Ue.Root){case Ue.Root:return o.getContainer();case Ue.Main:return o.getMainWidget().getContainer();case Ue.YAxis:return null!==(n=null===(i=o.getYAxisWidget())||void 0===i?void 0:i.getContainer())&&void 0!==n?n:null}}return null}getSize(t,e){var i,n;if(void 0===t)return{width:this._chartContainer.offsetWidth,height:this._chartContainer.offsetHeight,left:0,top:0,right:0,bottom:0};{const o=this.getPaneById(t);if(null!==o)switch(null!=e?e:Ue.Root){case Ue.Root:return o.getBounding();case Ue.Main:return o.getMainWidget().getBounding();case Ue.YAxis:return null!==(n=null===(i=o.getYAxisWidget())||void 0===i?void 0:i.getBounding())&&void 0!==n?n:null}}return null}setStyles(t){var e,i;let n;this._chartStore.setOptions({styles:t}),n=l(t)?Yt(t):t,void 0!==(null===(e=null==n?void 0:n.yAxis)||void 0===e?void 0:e.type)&&(null===(i=this.getPaneById(Nt.CANDLE))||void 0===i||i.getAxisComponent().setAutoCalcTickFlag(!0)),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getStyles(){return this._chartStore.getStyles()}setLocale(t){this._chartStore.setOptions({locale:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}getLocale(){return this._chartStore.getLocale()}setCustomApi(t){this._chartStore.setOptions({customApi:t}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}setPriceVolumePrecision(t,e){this._chartStore.setPrecision({price:t,volume:e})}getPriceVolumePrecision(){return this._chartStore.getPrecision()}setTimezone(t){this._chartStore.setOptions({timezone:t}),this._xAxisPane.getAxisComponent().buildTicks(!0),this._xAxisPane.update(3)}getTimezone(){return this._chartStore.getTimeScaleStore().getTimezone()}setOffsetRightDistance(t){this._chartStore.getTimeScaleStore().setOffsetRightDistance(t,!0)}setLeftMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}setRightMinVisibleBarCount(t){t>0&&this._chartStore.getTimeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}setBarSpace(t){this._chartStore.getTimeScaleStore().setBarSpace(t)}getBarSpace(){return this._chartStore.getTimeScaleStore().getBarSpace().bar}getVisibleRange(){return this._chartStore.getTimeScaleStore().getVisibleRange()}clearData(){this._chartStore.clearDataList()}getDataList(){return this._chartStore.getDataList()}applyNewData(t,e){this._chartStore.clearDataList(),this.applyMoreData(t,e)}applyMoreData(t,e){this._chartStore.addData(t,0,e),t.length>0&&this._chartStore.getIndicatorStore().calcInstance().then((t=>{this.adjustPaneViewport(!1,!0,!0,!0)})).catch((t=>{}))}updateData(t){const e=this._chartStore.getDataList(),i=e.length,n=t.timestamp,o=d(e[i-1],"timestamp",0);if(n>=o){let e=i;n===o&&(e=i-1),this._chartStore.addData(t,e),this._chartStore.getIndicatorStore().calcInstance().then((t=>{this.adjustPaneViewport(!1,!0,!0,!0)})).catch((t=>{}))}}loadMore(t){this._chartStore.getTimeScaleStore().setLoadMoreCallback(t)}createIndicator(t,e,i,n){var o,s;const r=l(t)?{name:t}:t;if(null===ct(r.name))return null;let a;if(void 0!==(null==i?void 0:i.id)&&this._panes.has(i.id))a=i.id,this._chartStore.getIndicatorStore().addInstance(r,a,null!=e&&e).then((t=>{var e,n;this._setPaneOptions(i,null!==(n=null===(e=this._panes.get(a))||void 0===e?void 0:e.getAxisComponent().buildTicks(!0))&&void 0!==n&&n)})).catch((t=>{}));else{a=null!==(o=null==i?void 0:i.id)&&void 0!==o?o:T(Nt.INDICATOR);const t=Array.from(this._panes.values()).pop(),l=new Be(this._chartContainer,this,a,t);t.setBottomPane(l);const c=null!==(s=null==i?void 0:i.height)&&void 0!==s?s:100;l.setBounding({height:c}),null!=i&&l.setOptions(i),this._panes.set(a,l),this._chartStore.getIndicatorStore().addInstance(r,a,null!=e&&e).finally((()=>{this.adjustPaneViewport(!0,!0,!0,!0,!0),null==n||n()}))}return a}overrideIndicator(t,e,i){this._chartStore.getIndicatorStore().override(t,null!=e?e:null).then((([t,e])=>{(t||e)&&(this.adjustPaneViewport(!1,e,!0,e),null==i||i())})).catch((()=>{}))}getIndicatorByPaneId(t,e){return this._chartStore.getIndicatorStore().getInstanceByPaneId(t,e)}removeIndicator(t,e){const i=this._chartStore.getIndicatorStore();if(i.removeInstance(t,e)){let e=!1;if(t!==Nt.CANDLE&&!i.hasInstances(t)){const i=this._panes.get(t);if(void 0!==i){e=!0;const n=i.getTopPane(),o=i.getBottomPane();null==o||o.setTopPane(n),null==n||n.setBottomPane(o),null==i||i.destroy(),this._panes.delete(t)}}this.adjustPaneViewport(e,!0,!0,!0,!0)}}createOverlay(t,e){const i=l(t)?{name:t}:t;if(null===Dt(i.name))return null;let n=!0;return void 0!==e&&null!==this.getPaneById(e)||(e=Nt.CANDLE,n=!1),this._chartStore.getOverlayStore().addInstance(i,e,n)}getOverlayById(t){return this._chartStore.getOverlayStore().getInstanceById(t)}overrideOverlay(t){this._chartStore.getOverlayStore().override(t)}removeOverlay(t){let e;void 0!==t&&(e=l(t)?{id:t}:t),this._chartStore.getOverlayStore().removeInstance(e)}setPaneOptions(t){this._setPaneOptions(t,!1)}setZoomEnabled(t){this._chartStore.getTimeScaleStore().setZoomEnabled(t)}isZoomEnabled(){return this._chartStore.getTimeScaleStore().getZoomEnabled()}setScrollEnabled(t){this._chartStore.getTimeScaleStore().setScrollEnabled(t)}isScrollEnabled(){return this._chartStore.getTimeScaleStore().getScrollEnabled()}scrollByDistance(t,e){const i=void 0===e||e<0?0:e,n=this._chartStore.getTimeScaleStore();if(i>0){n.startScroll();const e=(new Date).getTime(),o=()=>{const s=((new Date).getTime()-e)/i,r=s>=1,a=r?t:t*s;n.scroll(a),r||requestAnimationFrame(o)};o()}else n.startScroll(),n.scroll(t)}scrollToRealTime(t){const e=this._chartStore.getTimeScaleStore(),{bar:i}=e.getBarSpace(),n=(e.getOffsetRightBarCount()-e.getOffsetRightDistance()/i)*i;this.scrollByDistance(n,t)}scrollToDataIndex(t,e){const i=this._chartStore.getTimeScaleStore(),n=(i.getOffsetRightBarCount()+(this.getDataList().length-1-t))*i.getBarSpace().bar;this.scrollByDistance(n,e)}scrollToTimestamp(t,e){const i=F(this.getDataList(),"timestamp",t);this.scrollToDataIndex(i,e)}zoomAtCoordinate(t,e,i){const n=void 0===i||i<0?0:i,o=this._chartStore.getTimeScaleStore();if(n>0){const{bar:i}=o.getBarSpace(),s=i*t-i,r=(new Date).getTime(),a=()=>{const t=((new Date).getTime()-r)/n,l=t>=1,c=l?s:s*t;o.zoom(c/i,e),l||requestAnimationFrame(a)};a()}else o.zoom(t,e)}zoomAtDataIndex(t,e,i){const n=this._chartStore.getTimeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:n,y:0},i)}zoomAtTimestamp(t,e,i){const n=F(this.getDataList(),"timestamp",e);this.zoomAtDataIndex(t,n,i)}convertToPixel(t,e){var i;const{paneId:o=Nt.CANDLE,absolute:s=!1}=e;let r=[];if(o!==Nt.XAXIS){const e=this.getPaneById(o);if(null!==e){const i=this._chartStore.getTimeScaleStore(),n=e.getBounding(),o=(new Array).concat(t),a=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();r=o.map((t=>{const e={};let o=t.dataIndex;if(void 0!==t.timestamp&&(o=i.timestampToDataIndex(t.timestamp)),void 0!==o&&(e.x=null==a?void 0:a.convertToPixel(o)),void 0!==t.value){const i=null==l?void 0:l.convertToPixel(t.value);e.y=s?n.top+i:i}return e}))}}return n(t)?r:null!==(i=r[0])&&void 0!==i?i:{}}convertFromPixel(t,e){var i;const{paneId:o=Nt.CANDLE,absolute:s=!1}=e;let r=[];if(o!==Nt.XAXIS){const e=this.getPaneById(o);if(null!==e){const i=this._chartStore.getTimeScaleStore(),n=e.getBounding(),o=(new Array).concat(t),a=this._xAxisPane.getAxisComponent(),l=e.getAxisComponent();r=o.map((t=>{var e;const o={};if(void 0!==t.x){const n=a.convertFromPixel(t.x);o.dataIndex=n,o.timestamp=null!==(e=i.dataIndexToTimestamp(n))&&void 0!==e?e:void 0}if(void 0!==t.y){const e=s?t.y-n.top:t.y;o.value=l.convertFromPixel(e)}return o}))}}return n(t)?r:null!==(i=r[0])&&void 0!==i?i:{}}subscribeAction(t,e){this._chartStore.getActionStore().subscribe(t,e)}unsubscribeAction(t,e){this._chartStore.getActionStore().unsubscribe(t,e)}getConvertPictureUrl(t,e,i){const n=this._chartContainer.offsetWidth,o=this._chartContainer.offsetHeight,s=D("canvas",{width:`${n}px`,height:`${o}px`,boxSizing:"border-box"}),r=s.getContext("2d"),a=P(s);s.width=n*a,s.height=o*a,r.scale(a,a),r.fillStyle=null!=i?i:"#FFFFFF",r.fillRect(0,0,n,o);const l=null!=t&&t;this._panes.forEach((t=>{const e=t.getBounding();r.drawImage(t.getImage(l),0,e.top,n,e.height)}));const c=this._xAxisPane.getBounding();return r.drawImage(this._xAxisPane.getImage(l),0,c.top,n,c.height),s.toDataURL(`image/${null!=e?e:"jpeg"}`)}resize(){this.adjustPaneViewport(!0,!0,!0,!0,!0)}destroy(){this._chartEvent.destroy(),this._panes.forEach((t=>{t.destroy()})),this._panes.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer)}}const qe={};let Ke=1;const Je={clone:i,merge:e,isString:l,isNumber:r,isValid:a,isObject:s,isArray:n,isFunction:o,isBoolean:function(t){return"boolean"==typeof t},formatValue:d,formatPrecision:g,formatBigNumber:v,formatDate:u,getLinearSlopeIntercept:yt,getLinearYFromSlopeIntercept:xt,getLinearYFromCoordinates:ft,checkCoordinateOnArc:function(t,e){if(Math.abs(function(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}(t,e)-e.r)<2){const{r:i,startAngle:n,endAngle:o}=e,s=i*Math.cos(n)+e.x,r=i*Math.sin(n)+e.y,a=i*Math.cos(o)+e.x,l=i*Math.sin(o)+e.y;return t.x<=Math.max(s,a)+2&&t.x>=Math.min(s,a)-2&&t.y<=Math.max(r,l)+2&&t.y>=Math.min(r,l)-2}return!1},checkCoordinateOnCircle:Zt,checkCoordinateOnLine:_t,checkCoordinateOnPolygon:Jt,checkCoordinateOnRect:ee,checkCoordinateOnText:se,drawArc:function(t,e,i){const{x:n,y:o,r:s,startAngle:r,endAngle:a}=e,{style:l=m.Solid,size:c=1,color:h="currentColor",dashedValue:d=[2,2]}=i;t.lineWidth=c,t.strokeStyle=h,l===m.Dashed?t.setLineDash(d):t.setLineDash([]),t.beginPath(),t.arc(n,o,s,r,a),t.stroke(),t.closePath()},drawCircle:qt,drawLine:St,drawPolygon:Qt,drawRect:ie,drawText:re,drawRectText:le};t.dispose=function(t){var e;let i;if(l(t)){const n=document.getElementById(t);i=null!==(e=null==n?void 0:n.getAttribute("chartId"))&&void 0!==e?e:null}else i=t instanceof Ze?t.id:null!=t?t:t.chartId;null!==i&&(qe[i].destroy(),delete qe[i])},t.getFigureClass=function(t){var e;return null!==(e=he[t])&&void 0!==e?e:null},t.getSupportedFigures=function(){return Object.keys(he)},t.getSupportedIndicators=function(){return Object.keys(at)},t.getSupportedLocales=function(){return Object.keys(be)},t.getSupportedOverlays=function(){return Object.keys(Tt)},t.init=function(t,e){var i;let n;if(n=l(t)?document.getElementById(t):t,null===n)return null;let o=qe[null!==(i=n.chartId)&&void 0!==i?i:""];if(void 0!==o)return o;const s="k_line_chart_"+Ke++;return o=new Ze(n,e),o.id=s,n.chartId=s,qe[s]=o,o},t.registerFigure=function(t){he[t.name]=Ut.extend(t)},t.registerIndicator=function(t){at[t.name]=X.extend(t)},t.registerLocale=function(t,e){be[t]={...be[t],...e}},t.registerOverlay=function(t){Tt[t.name]=vt.extend(t)},t.registerStyles=function(t,e){zt[t]=e},t.utils=Je,t.version=function(){return"9.0.0"}}))},NGis:function(t,e,i){"use strict";t.exports=i("Ds32")}}]);